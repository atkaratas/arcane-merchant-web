<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Arcane Merchant | Shop Management Sim</title>
    <link rel="icon" type="image/png" href="favicon.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+Arabic:wght@400;700&family=Noto+Sans+Thai:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --dark-bg: rgba(15, 15, 20, 0.98);
            --parchment: #f4e4bc;
            --ui-font: 'Cinzel', serif;
            --dialogue-font: 'Crimson Text', serif;
            --magical-glow: 0 0 20px rgba(212, 175, 55, 0.4);
        }

        /* Language Overrides */
        body.lang-zh, body.lang-zh-TW { --ui-font: 'Noto Sans SC', sans-serif; --dialogue-font: 'Noto Sans SC', sans-serif; }
        body.lang-ja-JP { --ui-font: 'Noto Sans JP', sans-serif; --dialogue-font: 'Noto Sans JP', sans-serif; }
        body.lang-ko { --ui-font: 'Noto Sans KR', sans-serif; --dialogue-font: 'Noto Sans KR', sans-serif; }
        body.lang-ar { --ui-font: 'Noto Sans Arabic', sans-serif; --dialogue-font: 'Noto Sans Arabic', sans-serif; direction: rtl; }
        body.lang-th { --ui-font: 'Noto Sans Thai', sans-serif; --dialogue-font: 'Noto Sans Thai', sans-serif; }
        body.lang-ar .dialogue-text { text-align: right; }
        body.lang-ar .menu-container { direction: rtl; }
        body.lang-ar .speaker-name { left: auto; right: 40px; flex-direction: row-reverse; }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body, html { height: 100%; width: 100%; overflow: hidden; background-color: #050505; color: #fff; position: fixed; }

        .background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #050505 url('images/official-background.jpg?v=final_fix') no-repeat center center !important;
            background-size: cover !important; z-index: -1; filter: brightness(0.8) sepia(0.1);
            animation: slowZoom 60s linear infinite alternate;
        }
        @keyframes slowZoom { from { transform: scale(1); } to { transform: scale(1.15); } }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.6) 100%); pointer-events: none; z-index: 0; }
        .warm-overlay { position: fixed; bottom: 0; left: 0; width: 100%; height: 60%; background: radial-gradient(ellipse at bottom, rgba(255, 160, 60, 0.15) 0%, rgba(100, 50, 0, 0.05) 40%, transparent 80%); z-index: 0; pointer-events: none; mix-blend-mode: screen; }
        .lang-toggle { position: fixed; top: 10px; left: 10px; z-index: 1000; background: transparent; border: none; padding: 5px; cursor: pointer; transition: all 0.3s ease; font-size: 1.5rem; filter: drop-shadow(0 0 5px rgba(212, 175, 55, 0.6)); line-height: 1; }
        .lang-toggle:hover { transform: scale(1.1) rotate(5deg); }
        .game-container { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; width: 100vw; padding: 40px; opacity: 0; transition: opacity 1.5s ease-in; position: relative; z-index: 1; text-align: center; }
        .game-container.ready { opacity: 1; display: flex !important; }
        .branding-container { display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; z-index: 20; }
        .official-logo { max-width: 400px; width: 90%; height: auto; filter: drop-shadow(0 0 20px rgba(212,175,55,0.6)); margin-bottom: 5px; }
        .branding-container p { font-family: var(--ui-font); font-style: italic; font-size: 0.8rem; color: #ccc; letter-spacing: 2px; margin-top: 8px; line-height: 1.6; }
        #play-demo-link { font-family: var(--ui-font); font-style: italic; font-size: 0.8rem; color: #ff8c00; letter-spacing: 2px; text-decoration: none; font-weight: bold; text-shadow: 0 0 10px rgba(255, 140, 0, 0.6), 0 0 20px rgba(255, 140, 0, 0.4); transition: all 0.3s; display: block; margin-top: 2px; animation: radiantGlow 2s ease-in-out infinite alternate; }
        #play-demo-link:hover { color: #fff; text-shadow: 0 0 20px #ff8c00, 0 0 30px #ff4500; }
        @keyframes radiantGlow { from { opacity: 0.8; filter: brightness(1); } to { opacity: 1; filter: brightness(1.5); text-shadow: 0 0 15px #ff8c00, 0 0 25px #ff4500; } }
        
        .menu-container { display: flex; flex-direction: column; gap: 6px; z-index: 2000; width: 280px !important; margin: 0 auto 30px auto; position: relative; pointer-events: auto; }
        .menu-btn { background: rgba(10, 10, 15, 0.4); backdrop-filter: blur(5px); border: 2px double rgba(212, 175, 55, 0.6); border-radius: 4px; color: var(--gold); padding: 6px 12px; font-family: var(--ui-font); font-size: 0.8rem; cursor: pointer; transition: all 0.4s ease; text-transform: uppercase; letter-spacing: 1.2px; width: 100%; pointer-events: auto !important; z-index: 2001; height: 38px; display: flex; align-items: center; justify-content: center; text-decoration: none !important; }
        .menu-btn:hover { border-color: var(--gold); background: rgba(212, 175, 55, 0.15); transform: scale(1.02); text-decoration: none !important; }
        .btn-steam { text-decoration: none !important; }
        .btn-steam:hover { text-decoration: none !important; }

        .dialogue-wrapper { width: 100%; max-width: 900px; position: relative; transform: translateY(0); transition: transform 0.5s ease; text-align: left; }
        .dialogue-box { 
            background: transparent; 
            border: 45px solid transparent; 
            border-image-source: url('images/dialogue_frame.png');
            border-image-slice: 90 fill; 
            border-image-repeat: stretch; /* Changed to stretch to avoid cuts/residues */
            padding: 0 40px; 
            height: 160px; /* Reduced from 240px to keep it tiny */
            width: 100%;
            max-width: 600px; /* Limit width to keep it tiny under menu */
            margin: 0 auto; /* Center it */
            box-sizing: border-box;
            position: relative; 
            box-shadow: none; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .dialogue-text { 
            font-family: var(--dialogue-font); 
            font-size: 1.2rem; /* Reduced from 1.6rem to fit better in the frame */
            line-height: 1.4; 
            color: #fceeb5; 
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.8), 0 0 20px rgba(0,0,0,0.9); 
            position: relative; 
            z-index: 60; 
            width: 100%;
            text-align: center;
        }
        .dialogue-text::-webkit-scrollbar { display: none; } /* Hide scrollbar Chrome/Safari */
        .dialogue-text::after { content: "|"; animation: blink 1s step-end infinite; color: var(--gold); margin-left: 5px; }
        
        .speaker-name {
            display: none;
        }
        .game-icon-seal { width: 24px; height: 24px; object-fit: contain; }

        /* --- STATIC WRAPPING IVY FRAME (EMOJI STYLE) --- */
        .vine-frame { position: absolute; pointer-events: none; z-index: 50; filter: drop-shadow(2px 4px 5px rgba(0,0,0,0.9)); }
        
        /* Full side coverage */
        .vine-tl { top: -35px; left: -35px; width: 50%; height: 100px; }
        .vine-tr { top: -35px; right: -35px; width: 50%; height: 100px; transform: scaleX(-1); }
        .vine-bl { bottom: -35px; left: -35px; width: 50%; height: 100px; transform: scaleY(-1); }
        .vine-br { bottom: -35px; right: -35px; width: 50%; height: 100px; transform: scale(-1); }
        
        /* Side Pillars */
        .vine-side-l { top: 40px; left: -25px; width: 40px; height: calc(100% - 80px); background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 100"><path d="M20 0 Q 30 25 10 50 T 20 100" stroke="%233e2723" stroke-width="3" fill="none"/></svg>') no-repeat center; z-index: 50; }
        .vine-side-r { top: 40px; right: -25px; width: 40px; height: calc(100% - 80px); transform: scaleX(-1); background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 100"><path d="M20 0 Q 30 25 10 50 T 20 100" stroke="%233e2723" stroke-width="3" fill="none"/></svg>') no-repeat center; z-index: 50; }

        /* BUTTERFLY (Faster & 3D) */
        .butterfly { 
            position: absolute; width: 20px; height: 20px; z-index: 3000; /* Super high to sit on menus */
            pointer-events: none; transform-style: preserve-3d; will-change: transform, top, left; 
            transition: top 6s ease-in-out, left 6s ease-in-out, transform 1s ease-in-out; /* Slower flight (6s) */
            perspective: 200px; /* Strong perspective for 3D wings */
        }
        .butterfly-body { position: absolute; top: 50%; left: 50%; width: 4px; height: 14px; background: #222; border-radius: 5px; transform: translate(-50%, -50%); }
        .wing { position: absolute; top: 0; width: 14px; height: 22px; border-radius: 50% 50% 10% 50%; opacity: 0.9; filter: drop-shadow(0 0 4px currentColor); }
        .wing.left { right: 50%; transform-origin: 100% 50%; animation: flapLeft 0.25s infinite alternate ease-in-out; }
        .wing.right { left: 50%; transform-origin: 0% 50%; transform: scaleX(-1); animation: flapRight 0.25s infinite alternate ease-in-out; }
        .bt-gold { color: #ffd700; } .bt-gold .wing { background: radial-gradient(circle at 30% 30%, #ffd700, #ff8c00); }
        .bt-blue { color: #00bfff; } .bt-blue .wing { background: radial-gradient(circle at 30% 30%, #00bfff, #1e90ff); }
        .bt-purple { color: #e056fd; } .bt-purple .wing { background: radial-gradient(circle at 30% 30%, #e056fd, #8e44ad); }
        @keyframes flapLeft { 0% { transform: rotateY(-20deg); } 100% { transform: rotateY(60deg); } }
        @keyframes flapRight { 0% { transform: scaleX(-1) rotateY(-20deg); } 100% { transform: scaleX(-1) rotateY(60deg); } }
        
        /* Landed State: Slow Flap */
        .butterfly.landed .wing { animation-duration: 3s; }
        
        .ember {
            position: fixed; bottom: -10px; width: 2px; height: 2px; border-radius: 50%;
            background: #fff; /* White center for hot look */
            box-shadow: 0 0 5px rgba(255, 200, 50, 1), 0 0 10px rgba(255, 100, 0, 0.8); /* Intense glow */
            pointer-events: none; z-index: 70; /* Above dialogue box background */
            animation: firefly-rise linear forwards;
        }
        @keyframes firefly-rise {
            0% { bottom: -10px; transform: translateX(0) scale(1); opacity: 0; }
            20% { opacity: 1; transform: translateX(10px) scale(1.2); }
            50% { transform: translateX(-10px) scale(0.8); }
            80% { opacity: 0.8; }
            100% { bottom: 25vh; transform: translateX(5px) scale(0.5); opacity: 0; }
        }

        .petal { position: fixed; top: -50px; z-index: 25; pointer-events: none; opacity: 1.0; border-radius: 50% 0 50% 50%; background: var(--petal-color); animation: fall linear forwards, sway ease-in-out infinite alternate; box-shadow: 0 0 2px rgba(0,0,0,0.3); }
        .petal.pink { --petal-color: #ffb7c5; } .petal.red { --petal-color: #dc143c; } .petal.maroon { --petal-color: #800020; }
        @keyframes fall { 0% { top: -10vh; } 100% { top: 110vh; } }
        @keyframes sway { 0% { transform: translateX(-40px) rotate(0deg); } 100% { transform: translateX(40px) rotate(45deg); } }

        .findie-logo-fixed { position: fixed; top: 15px; right: 10px; display: flex !important; align-items: center !important; gap: 8px !important; opacity: 0.95; transition: all 0.4s; text-decoration: none; color: var(--gold); font-family: var(--ui-font); font-size: 0.6rem; padding: 6px 12px; border-radius: 4px; background: rgba(0,0,0,0.85); z-index: 9999; border: 1px solid rgba(212,175,55,0.6); width: auto !important; height: auto !important; max-width: 150px !important; max-height: 40px !important; }
        .findie-logo-fixed img { width: 20px !important; height: 20px !important; object-fit: contain !important; display: block !important; max-width: 20px !important; max-height: 20px !important; }
        .findie-logo-fixed:hover { opacity: 1; transform: translateY(-2px); border-color: #fff; }
        .copyright-footer { position: fixed; bottom: 5px; width: 100%; text-align: center; font-family: var(--ui-font); font-size: 0.5rem; color: rgba(255,255,255,0.3); text-transform: uppercase; z-index: 500; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 2000; justify-content: center; align-items: center; padding: 20px; opacity: 0; transition: opacity 0.5s; }
        .modal.visible { display: flex; opacity: 1; }
        .parchment { background: var(--parchment); color: #2c1e0f; width: auto; max-width: 750px; display: inline-block; padding: 40px; border-radius: 3px; box-shadow: 0 20px 50px rgba(0,0,0,0.7); position: relative; font-family: var(--dialogue-font); max-height: 90vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.4s; }
        .modal.visible .parchment { transform: scale(1); }
        .close-modal { position: absolute; top: 15px; left: 20px; font-size: 2.5rem; cursor: pointer; color: #8b4513; z-index: 10; }
        
        .lang-btn { cursor: pointer; padding: 5px 10px; transition: all 0.2s; border-radius: 4px; }
        .lang-btn:hover { background: rgba(139, 69, 19, 0.1); color: #8b4513; }
        .lang-btn.active { font-weight: bold; color: #8b4513; text-decoration: underline; }
        .lang-grid { display: flex; flex-direction: column; gap: 5px; text-align: left; }
        .story-container { position: relative; width: 100%; height: 80vh; max-height: 800px; display: flex; flex-direction: column; }
        .story-progress { position: absolute; top: 10px; left: 0; width: 100%; display: flex; gap: 4px; padding: 0 10px; z-index: 20; }
        .story-bar { flex: 1; height: 3px; background: rgba(255,255,255,0.3); border-radius: 2px; overflow: hidden; }
        .story-bar-fill { height: 100%; width: 0%; background: #fff; transition: width 0.2s linear; }
        .story-bar.active .story-bar-fill { width: 100%; } .story-bar.seen .story-bar-fill { width: 100%; }
        .story-header { position: absolute; top: 25px; left: 55px; display: flex; align-items: center; gap: 10px; z-index: 20; }
        .story-avatar { width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--gold); }
        .story-info { display: flex; flex-direction: column; }
        .story-username { color: #fff; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.9); }
        .story-time { color: rgba(255,255,255,0.9); font-size: 0.75rem; text-shadow: 0 2px 4px rgba(0,0,0,0.9); }
        .story-content { position: relative; flex: 1; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .story-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; filter: blur(20px) brightness(0.6); opacity: 0.6; transform: scale(1.1); }
        .story-img-main { position: relative; width: 100%; max-width: 400px; aspect-ratio: 1/1; object-fit: contain; z-index: 2; box-shadow: 0 0 30px rgba(0,0,0,0.5); border-radius: 8px; }
        .tap-zone { position: absolute; top: 0; height: 100%; width: 35%; z-index: 10; cursor: pointer; } .tap-zone.left { left: 0; } .tap-zone.right { right: 0; }
        .video-container { position: relative; width: 100%; padding-top: 56.25%; background: #000; border: 4px solid var(--gold); }
        video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; }
        .community-links { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .community-item { display: flex; align-items: center; gap: 10px; text-decoration: none; color: #2c1e0f; font-size: 1.1rem; padding: 10px; background: rgba(139,69,19,0.05); border-radius: 4px; transition: all 0.3s; }
        .community-item:hover { background: rgba(139,69,19,0.12); transform: translateY(-2px); }

        @media (max-width: 768px) {
            .game-container { padding-top: 20px; padding-bottom: 180px; overflow-y: auto; display: block !important; }
            .official-logo { max-width: 240px; margin-top: 40px; }
            .menu-container { width: 85% !important; margin-bottom: 30px; }
            .dialogue-wrapper { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 94%; margin: 0; }
            .dialogue-box { padding: 25px 20px; min-height: 120px; margin-bottom: 20px; }
            .dialogue-text { font-size: 1.1rem; }
            .speaker-name { top: -12px; left: 20px; font-size: 0.65rem; padding: 3px 15px; }
            .vine-tl, .vine-tr, .vine-bl, .vine-br { width: 100px; height: 100px; }
            .findie-logo-fixed { top: 10px; right: 10px; padding: 4px 8px; font-size: 0.5rem; max-width: 100px !important; }
            .findie-logo-fixed img { width: 16px !important; height: 16px !important; max-width: 16px !important; max-height: 16px !important; }
        }
    </style>
</head>
<body>
    <div class="background"></div><div class="overlay"></div><div class="warm-overlay"></div>
    <div class="lang-toggle" onclick="showModal('lang-modal')" title="Select Region"><span style="font-size: 1.5rem;">üó∫Ô∏è</span></div>

    <div id="game-ui" class="game-container">
        <div class="branding-container">
            <img src="images/official_logo.png" alt="Arcane Merchant Logo" class="official-logo">
            <p id="game-subtitle">MEDIEVAL FANTASY SHOP SIMULATOR ‚Ä¢ APRIL 10 2026 RELEASE!</p>
            <a href="https://store.steampowered.com/app/4086760/Arcane_Merchant/" target="_blank" id="play-demo-link">PLAY DEMO NOW!</a>
        </div>
        <div class="menu-container">
            <!-- Buttons injected by JS (ID's important for butterflies) -->
        </div>

        <div class="dialogue-wrapper">
            <div class="dialogue-box">
                <!-- Static Image Frame Implementation -->
                <!-- Note: The frame is applied via CSS .dialogue-box using border-image -->
                
                <div class="speaker-name">
                    <img src="images/arcane_initial_logo.jpg" class="game-icon-seal" alt="Seal">
                    Master Merchant
                </div>
                <div id="dialogue" class="dialogue-text"></div>
            </div>
        </div>

        <a href="https://findiestudios.com" target="_blank" class="findie-logo-fixed"><span>¬© 2026 Findie</span><img src="images/findie_logo.webp" class="studio-logo" alt="Findie Studios Logo"></a>
        <div class="copyright-footer">¬© 2026 Findie Studios. All Rights Reserved.</div>
    </div>

    <!-- Modals (Common Room, About, etc) kept same as before ... -->
    <div id="lang-modal" class="modal"><div class="parchment"><span class="close-modal" onclick="closeModals()">&times;</span><h2>Select Region</h2><div class="lang-grid" id="lang-grid"></div></div></div>
    <div id="wares-modal" class="modal" style="background: rgba(0,0,0,0.4);"><div class="parchment" style="max-width: 500px; padding: 0; background: transparent; box-shadow: none; border: none;"><span class="close-modal" onclick="closeModals()" style="z-index: 50; color: #fff; text-shadow: 0 0 10px #000; top: 20px; left: 20px;">&times;</span><div class="story-container"><div class="story-progress" id="story-progress"></div><div class="story-header"><img src="images/arcane_initial_logo.jpg" class="story-avatar"><div class="story-info"><span class="story-username">Arcane Merchant</span><span class="story-time" id="txt-story-subtitle">New Arrival</span></div></div><div class="story-content"><div class="story-bg" id="story-bg"></div><img id="story-image" src="" class="story-img-main"><video id="story-video" class="story-img-main" playsinline muted loop style="display: none;"></video></div><div class="tap-zone left" onclick="moveCarousel(-1)"></div><div class="tap-zone right" onclick="moveCarousel(1)"></div></div></div></div>
    <div id="rumors-modal" class="modal"><div class="parchment" style="max-width: 600px;"><span class="close-modal" onclick="closeModals()">&times;</span><h2 style="font-size: 1.8rem; margin-bottom: 25px;">Whispers from the Void</h2><div style="margin-top: 20px; text-align: left;"><div style="margin-bottom: 25px; border-bottom: 1px dashed rgba(139, 69, 19, 0.2); padding-bottom: 15px;"><p id="txt-specs-title" style="font-weight: bold; color: #5d2e0a; margin-bottom: 15px;">‚ö° Scroll of Summoning</p><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 0.9rem;"><div><p id="txt-specs-min" style="font-weight: bold; color: #8b4513; margin-bottom: 5px;">Minimum Invocation</p><ul style="list-style: none; padding: 0; opacity: 0.8; font-size: 0.8rem; line-height: 1.4;"><li><strong>OS:</strong> Windows 10 (64-bit)</li><li><strong>CPU:</strong> i5-4460 / Ryzen 3 1200</li><li><strong>RAM:</strong> 8 GB</li><li><strong>GPU:</strong> GTX 960M / 750 Ti</li><li><strong>Space:</strong> 2 GB available</li></ul></div><div><p id="txt-specs-rec" style="font-weight: bold; color: #8b4513; margin-bottom: 5px;">Recommended Ritual</p><ul style="list-style: none; padding: 0; opacity: 0.8; font-size: 0.8rem; line-height: 1.4;"><li><strong>OS:</strong> Windows 10 / 11</li><li><strong>CPU:</strong> i5-9400 / Ryzen 5 3600</li><li><strong>RAM:</strong> 16 GB</li><li><strong>GPU:</strong> GTX 1660 / RTX 2060</li><li><strong>Space:</strong> 2 GB available</li></ul></div></div></div><div style="margin-bottom: 25px; border-bottom: 1px dashed rgba(139, 69, 19, 0.2); padding-bottom: 15px;"><p id="rumor-1-title" style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;"></p><p id="rumor-1-desc" style="font-style: italic; opacity: 0.8;"></p></div><div style="margin-bottom: 25px; border-bottom: 1px dashed rgba(139, 69, 19, 0.2); padding-bottom: 15px;"><p id="rumor-2-title" style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;"></p><p id="rumor-2-desc" style="font-style: italic; opacity: 0.8;"></p></div><div style="margin-bottom: 25px; border-bottom: 1px dashed rgba(139, 69, 19, 0.2); padding-bottom: 15px;"><p id="rumor-3-title" style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;"></p><p id="rumor-3-desc" style="font-style: italic; opacity: 0.8;"></p></div><div><p id="rumor-4-title" style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;"></p><p id="rumor-4-desc" style="font-style: italic; opacity: 0.8;"></p></div></div></div></div>
    <div id="community-modal" class="modal"><div class="parchment"><span class="close-modal" onclick="closeModals()">&times;</span><h2>The Common Room</h2><div class="community-links"><a href="https://www.findiestudios.com/" target="_blank" class="community-item"><span class="community-icon">üè∞</span> Findie</a><a href="https://discord.gg/findiestudios" target="_blank" class="community-item"><span class="community-icon">‚öîÔ∏è</span> Discord</a><a href="https://x.com/FindieStudios" target="_blank" class="community-item"><span class="community-icon">üìú</span> Twitter</a><a href="https://www.youtube.com/@FindieStudios" target="_blank" class="community-item"><span class="community-icon">üõ°Ô∏è</span> YouTube</a><a href="https://www.instagram.com/findiestudios" target="_blank" class="community-item"><span class="community-icon">üè∫</span> Instagram</a><a href="https://www.tiktok.com/@findiestudios" target="_blank" class="community-item"><span class="community-icon">üé≠</span> TikTok</a><a href="https://www.reddit.com/r/arcanemerchant" target="_blank" class="community-item"><span class="community-icon">‚öíÔ∏è</span> Reddit</a><a href="https://www.linkedin.com/company/findiestudios" target="_blank" class="community-item"><span class="community-icon">üóùÔ∏è</span> LinkedIn</a></div></div></div>
    <div id="about-modal" class="modal"><div class="parchment" style="max-width: 850px; width: 95vw;"><span class="close-modal" onclick="closeModals()">&times;</span><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid rgba(139, 69, 19, 0.3); padding-bottom: 15px;"><h2 style="margin: 0; border: none;">The Merchant's Guide</h2></div><div id="about-content" style="margin-top: 20px; line-height: 1.6; font-size: 1.1rem;"><p id="about-intro" style="margin-bottom: 25px; font-style: italic;"></p><div id="about-features" style="display: grid; grid-template-columns: 1fr; gap: 20px;"></div></div></div></div>
    <div id="video-modal" class="modal" style="background: rgba(0,0,0,0.95); z-index: 10000;">
        <div class="parchment" style="max-width: 900px; width: 90vw; background: #000; border: 2px solid var(--gold); padding: 10px; position: relative;">
            <span class="close-modal" onclick="closeVideoModal()" style="color: #fff; top: -50px; left: 0; cursor: pointer; font-size: 3rem;">&times;</span>
            <div class="video-container" style="width: 100%; height: 0; padding-top: 56.25%; position: relative; background: #000;">
                <video id="video-player" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" controls playsinline webkit-playsinline></video>
            </div>
        </div>
    </div>

    <script src="translations.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const dialogueElement = document.getElementById('dialogue');
        let merchantDialogues = []; 
        let currentLang = 'en'; 
        
        const menuKeys = [
            { key: 'menu_watch', action: 'handleWatch()' },
            { key: 'menu_wares', action: 'handleWares()' },
            { key: 'menu_rumors', action: 'handleRumors()' },
            { key: 'menu_common', action: 'handleCommunity()' },
            { key: 'menu_about', action: 'handleAbout()' },
            { key: 'menu_steam', link: 'https://store.steampowered.com/app/4086760/Arcane_Merchant/' }
        ];

        let currentDialogueIndex = 0;
        let typeTimeout;
        let autoTalkInterval;
        let isTyping = false;
        let hls;

        // Interaction Timeout for "Idle" detection
        let idleTimer;
        let isIdle = false;

        function resetIdleTimer() {
            isIdle = false;
            if (idleTimer) clearTimeout(idleTimer);
            idleTimer = setTimeout(() => {
                isIdle = true;
                // Maybe force a butterfly to the Steam button here immediately?
            }, 10000); // 10s idle
        }

        function getQuotes() {
            if (!translations[currentLang] || !translations[currentLang].merchant) return translations['en'].merchant.quotes;
            return translations[currentLang].merchant.quotes;
        }

        // Hook all interactions
        window.handleWatch = function() { resetIdleTimer(); resetAutoTalk(); showVideoModal(); typeWriter(getQuotes()[0], dialogueElement, 30); }
        window.handleWares = function() { resetIdleTimer(); resetAutoTalk(); showModal('wares-modal'); initCarousel(); typeWriter(getQuotes()[1], dialogueElement, 30); }
        window.handleRumors = function() { resetIdleTimer(); resetAutoTalk(); showModal('rumors-modal'); typeWriter(getQuotes()[4], dialogueElement, 30); }
        window.handleCommunity = function() { resetIdleTimer(); resetAutoTalk(); showModal('community-modal'); typeWriter(getQuotes()[8], dialogueElement, 30); }
        window.handleAbout = function() { resetIdleTimer(); resetAutoTalk(); showModal('about-modal'); typeWriter(getQuotes()[2], dialogueElement, 30); }

        function startAutoTalk() {
            if (autoTalkInterval) clearInterval(autoTalkInterval);
            autoTalkInterval = setInterval(() => {
                if (isTyping) return;
                const quotes = getQuotes();
                let nextIndex = Math.floor(Math.random() * quotes.length);
                if (nextIndex === currentDialogueIndex && quotes.length > 1) nextIndex = (nextIndex + 1) % quotes.length;
                currentDialogueIndex = nextIndex;
                typeWriter(quotes[currentDialogueIndex], dialogueElement, 40);
            }, 12000);
        }

        function resetAutoTalk() { startAutoTalk(); }

        function closeModals() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('visible'));
            stopC();
            resetIdleTimer();
        }

        function showModal(modalId) {
            closeModals();
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.add('visible');
        }

        function showVideoModal() {
            const modal = document.getElementById('video-modal'), video = document.getElementById('video-player');
            const hlsSrc = 'https://video.fastly.steamstatic.com/store_trailers/4086760/1025836541/d1d348ada576efe61787479707370305904dfecb/1769431428/hls_264_master.m3u8';
            const mp4Fallback = 'https://video.fastly.steamstatic.com/store_trailers/4086760/1025836541/d1d348ada576efe61787479707370305904dfecb/1769431428/movie480.mp4';
            
            modal.classList.add('visible');
            video.controls = true;
            
            if (Hls.isSupported()) {
                if (hls) hls.destroy();
                hls = new Hls();
                hls.loadSource(hlsSrc);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    video.play().catch(e => console.log("Hls.js autoplay prevented"));
                });
                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        console.log("Hls.js fatal error, trying native/fallback");
                        video.src = mp4Fallback;
                        video.play();
                    }
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Native HLS support (Safari)
                video.src = hlsSrc;
                video.play().catch(e => {
                    video.src = mp4Fallback;
                    video.play();
                });
            } else {
                video.src = mp4Fallback;
                video.play();
            }
        }

        function closeVideoModal() { 
            const video = document.getElementById('video-player');
            video.pause();
            video.src = "";
            if (hls) hls.destroy();
            closeModals(); 
        }

        function typeWriter(text, element, speed = 35, callback) {
            if (isTyping) clearTimeout(typeTimeout);
            isTyping = true; element.innerHTML = ""; let i = 0;
            if (!text) text = "...";
            function type() {
                if (i < text.length) { element.innerHTML += text.charAt(i); i++; typeTimeout = setTimeout(type, speed); }
                else { isTyping = false; if (callback) callback(); }
            }
            type();
        }

        let carouselImages = [];
        for (let i = 1; i <= 16; i++) carouselImages.push({ type: 'image', src: `images/inventory/inventory_${i}.jpg?v=force_refresh_${Date.now()}` });
        carouselImages.splice(2, 0, { type: 'video', src: 'images/inventory/story_clip_1.mp4' });
        carouselImages.splice(5, 0, { type: 'video', src: 'images/inventory/story_clip_2.mp4' });
        carouselImages.splice(8, 0, { type: 'video', src: 'images/inventory/story_clip_3.mp4' });
        carouselImages.splice(11, 0, { type: 'video', src: 'images/inventory/story_clip_4.mp4' });
        carouselImages.splice(14, 0, { type: 'video', src: 'images/inventory/story_clip_5.mp4' });
        carouselImages.splice(17, 0, { type: 'video', src: 'images/inventory/story_clip_6.mp4' });
        
        let currentCarouselIndex = 0, carouselInterval;

        function initCarousel() {
            const progressContainer = document.getElementById('story-progress');
            progressContainer.innerHTML = '';
            carouselImages.forEach((_, index) => {
                const bar = document.createElement('div'); bar.className = 'story-bar';
                const fill = document.createElement('div'); fill.className = 'story-bar-fill';
                bar.appendChild(fill); progressContainer.appendChild(bar);
            });
            startC();
        }

        function startC() { stopC(); showCarouselImage(currentCarouselIndex); }
        function stopC() { 
            if (carouselInterval) clearTimeout(carouselInterval);
            const video = document.getElementById('story-video');
            if (video) { video.onended = null; video.ontimeupdate = null; video.pause(); }
        }

        function showCarouselImage(index) {
            if (index >= carouselImages.length) currentCarouselIndex = 0;
            else if (index < 0) currentCarouselIndex = carouselImages.length - 1;
            else currentCarouselIndex = index;

            const item = carouselImages[currentCarouselIndex];
            const mainImg = document.getElementById('story-image');
            const mainVideo = document.getElementById('story-video');
            const bgDiv = document.getElementById('story-bg');
            
            const bars = document.querySelectorAll('.story-bar-fill');
            bars.forEach(b => { b.style.width = '0%'; b.style.transition = 'none'; });
            for(let i=0; i<currentCarouselIndex; i++) bars[i].style.width = '100%';
            const currentBar = bars[currentCarouselIndex];
            
            if (item.type === 'video') {
                mainImg.style.display = 'none'; mainVideo.style.display = 'block';
                mainVideo.src = item.src; mainVideo.currentTime = 0;
                bgDiv.style.backgroundImage = 'none'; bgDiv.style.backgroundColor = 'transparent';
                currentBar.style.transition = 'none';
                mainVideo.ontimeupdate = () => { if (mainVideo.duration) currentBar.style.width = `${(mainVideo.currentTime / mainVideo.duration) * 100}%`; };
                mainVideo.play().then(() => { mainVideo.onended = () => moveCarousel(1); })
                .catch(e => { carouselInterval = setTimeout(() => moveCarousel(1), 4000); });
            } else {
                if (mainVideo) { mainVideo.pause(); mainVideo.style.display = 'none'; }
                mainImg.style.display = 'block'; mainImg.src = item.src;
                if (bgDiv) bgDiv.style.backgroundImage = `url('${item.src}')`;
                setTimeout(() => { currentBar.style.transition = 'width 4s linear'; currentBar.style.width = '100%'; }, 10);
                carouselInterval = setTimeout(() => moveCarousel(1), 4000);
            }
        }
        function moveCarousel(step) { stopC(); showCarouselImage(currentCarouselIndex + step); }

        function initLanguage() {
            try {
                const grid = document.getElementById('lang-grid');
                if (grid) {
                    grid.innerHTML = '';
                    if (typeof translations === 'undefined') throw new Error("Translations missing");
                    Object.keys(translations).forEach(code => {
                        const btn = document.createElement('div'); btn.className = 'lang-btn';
                        btn.innerText = translations[code].name; btn.onclick = () => setLanguage(code);
                        if (code === currentLang) btn.classList.add('active'); grid.appendChild(btn);
                    });
                }
                const saved = localStorage.getItem('arcane_lang');
                if (saved && translations[saved]) setLanguage(saved); else setLanguage('en');
            } catch(e) { console.error("Lang Init Failed", e); setLanguage('en'); }
        }

        function setLanguage(code) {
            if (!translations || !translations[code]) code = 'en';
            currentLang = code; localStorage.setItem('arcane_lang', code);
            const data = translations[code]; const en = translations['en'];
            
            document.body.className = `lang-${code}`;

            document.querySelectorAll('.lang-btn').forEach(b => { b.classList.remove('active'); if (b.innerText === data.name) b.classList.add('active'); });
            if (document.getElementById('lang-modal').classList.contains('visible')) closeModals();
            const menuContainer = document.querySelector('.menu-container');
            if (menuContainer) {
                menuContainer.innerHTML = '';
                menuKeys.forEach(item => {
                    let el; let text = "Menu Item";
                    try { text = (data.ui && data.ui[item.key]) ? data.ui[item.key] : (en.ui && en.ui[item.key] ? en.ui[item.key] : item.key); } catch(e) { text = item.key; }
                    if (item.link) {
                        el = document.createElement('a'); el.href = item.link; el.target = "_blank"; 
                        el.className = 'menu-btn btn-steam';
                        el.style = "color: #fff; background: linear-gradient(135deg, #1b2838 0%, #2a475e 100%); border-color: #66c0f4; display: flex; align-items: center; justify-content: center; gap: 10px;";
                        el.innerHTML = `<img src="images/steam_logo_official.jpg" width="20" height="20" style="border-radius: 50%;"> ${text}`;
                    } else {
                        el = document.createElement('button'); el.className = 'menu-btn';
                        if (item.key === 'menu_watch') el.setAttribute('onclick', 'window.handleWatch()');
                        else if (item.key === 'menu_wares') el.setAttribute('onclick', 'window.handleWares()');
                        else if (item.key === 'menu_rumors') el.setAttribute('onclick', 'window.handleRumors()');
                        else if (item.key === 'menu_common') el.setAttribute('onclick', 'window.handleCommunity()');
                        else if (item.key === 'menu_about') el.setAttribute('onclick', 'window.handleAbout()');
                        el.innerText = text;
                    }
                    menuContainer.appendChild(el);
                });
            }
            const safeText = (selector, key) => { const el = document.querySelector(selector); if (el) try { el.innerText = (data.ui && data.ui[key]) ? data.ui[key] : (en.ui ? en.ui[key] : ""); } catch(e) {} };
            safeText('#wares-modal .story-username', 'merchant_name');
            safeText('#rumors-modal h2', 'modal_rumors_title');
            safeText('#community-modal h2', 'modal_common_title');
            safeText('#about-modal h2', 'modal_about_title');
            safeText('.copyright-footer', 'footer_rights');
            const specsTitle = (data.ui && data.ui['specs_title']) ? data.ui['specs_title'] : (en.ui ? en.ui['specs_title'] : "Scroll of Summoning");
            const elSpecs = document.getElementById('txt-specs-title'); if(elSpecs) elSpecs.innerText = "‚ö° " + specsTitle;
            safeText('#txt-specs-min', 'specs_min'); safeText('#txt-specs-rec', 'specs_rec');
            if (data.rumors && Array.isArray(data.rumors)) {
                for(let i=0; i<4; i++) {
                    if (data.rumors[i]) {
                        const rTitle = document.getElementById(`rumor-${i+1}-title`); const rDesc = document.getElementById(`rumor-${i+1}-desc`);
                        if (rTitle) rTitle.innerText = data.rumors[i].title; if (rDesc) rDesc.innerText = data.rumors[i].desc;
                    }
                }
            } else if (en.rumors) {
                for(let i=0; i<4; i++) {
                    const rTitle = document.getElementById(`rumor-${i+1}-title`); const rDesc = document.getElementById(`rumor-${i+1}-desc`);
                    if (rTitle) rTitle.innerText = en.rumors[i].title; if (rDesc) rDesc.innerText = en.rumors[i].desc;
                }
            }
            const subtitleMap = { 'tr': 'Yeni Gelen', 'de': 'Neuank√∂mmling', 'fr-FR': 'Nouvel Arrivant', 'es-ES': 'Reci√©n Llegado', 'ru-RU': '–ù–æ–≤–æ–µ –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ', 'zh': 'Êñ∞Âà∞Ë¥ß', 'zh-TW': 'Êñ∞Âà∞Ë≤®', 'ja-JP': 'Êñ∞ÂÖ•Ëç∑', 'ko': 'Ïã†ÏÉÅÌíà', 'pt-BR': 'Rec√©m Chegado', 'it': 'Nuovo Arrivo', 'pl-PL': 'Nowa Dostawa' };
            const subText = subtitleMap[code] || "New Arrival";
            const elSub = document.getElementById('txt-story-subtitle'); if(elSub) elSub.innerText = subText;
            const mName = (data.ui && data.ui['merchant_name']) ? data.ui['merchant_name'] : (en.ui ? en.ui['merchant_name'] : "Merchant");
            const seal = document.querySelector('.speaker-name'); if (seal) seal.innerHTML = `<img src="images/arcane_initial_logo.jpg" class="game-icon-seal" alt="Seal"> ${mName}`;
            
            const gSubtitle = (data.ui && data.ui['game_subtitle']) ? data.ui['game_subtitle'] : (en.ui ? en.ui['game_subtitle'] : "MEDIEVAL FANTASY SHOP SIMULATOR ‚Ä¢ APRIL 10 2026 RELEASE!");
            const elSubtitle = document.getElementById('game-subtitle'); if (elSubtitle) elSubtitle.innerText = gSubtitle;

            const gDemo = (data.ui && data.ui['menu_demo']) ? data.ui['menu_demo'] : (en.ui ? en.ui['menu_demo'] : "PLAY DEMO NOW!");
            const elDemo = document.getElementById('play-demo-link'); if (elDemo) elDemo.innerText = gDemo;

            if (data.merchant && data.merchant.quotes) merchantDialogues = data.merchant.quotes; else if (en.merchant && en.merchant.quotes) merchantDialogues = en.merchant.quotes;
            const welcome = (data.merchant && data.merchant.welcome) ? data.merchant.welcome : (en.merchant ? en.merchant.welcome : "Welcome.");
            if (!isTyping) typeWriter(welcome, dialogueElement, 40);
            resetAutoTalk();
            if (typeof updateAboutText === 'function') updateAboutText(code);
            const toast = document.createElement('div'); toast.innerText = `Region Set: ${data.name}`;
            toast.style.position = 'fixed'; toast.style.top = '20px'; toast.style.left = '50%'; toast.style.transform = 'translateX(-50%)'; toast.style.background = 'rgba(0,0,0,0.8)'; toast.style.color = '#d4af37'; toast.style.padding = '10px 20px'; toast.style.borderRadius = '4px'; toast.style.border = '1px solid #d4af37'; toast.style.zIndex = '3000'; toast.style.fontFamily = 'var(--ui-font)';
            document.body.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 500); }, 2000);
        }

        function updateAboutText(langCode) {
            const data = translations[langCode]; if (!data) return;
            document.getElementById('about-intro').innerText = data.intro;
            const featuresContainer = document.getElementById('about-features'); featuresContainer.innerHTML = '';
            data.features.forEach(feature => {
                const p = document.createElement('p'); const parts = feature.split('\n'); const headline = parts[0]; const body = parts[1] || "";
                p.innerHTML = `<strong>${headline}</strong><br><span style="opacity: 0.9; font-size: 0.95em;">${body}</span>`;
                p.style.marginBottom = '20px'; p.style.paddingLeft = '15px'; p.style.borderLeft = '3px solid #d4af37'; featuresContainer.appendChild(p);
            });
            let endingEl = document.getElementById('about-ending');
            if (!endingEl) { endingEl = document.createElement('p'); endingEl.id = 'about-ending'; endingEl.style.marginTop = '30px'; endingEl.style.fontWeight = 'bold'; endingEl.style.color = '#d4af37'; endingEl.style.textAlign = 'center'; document.getElementById('about-content').appendChild(endingEl); }
            endingEl.innerText = data.ending || "";
        }

        // --- MAJESTIC BUTTERFLY LOGIC (2x Faster & Smart Landing) ---
        function spawnButterfly() {
            const dialogueBox = document.querySelector('.dialogue-box'); if (!dialogueBox) return;
            if (document.querySelectorAll('.butterfly').length >= 5) return;

            const b = document.createElement('div'); 
            const colorClass = ['bt-gold', 'bt-blue', 'bt-purple'][Math.floor(Math.random() * 3)];
            b.className = `butterfly ${colorClass}`; 
            b.innerHTML = '<div class="butterfly-body"></div><div class="wing left"></div><div class="wing right"></div>';

            // Collect Potential Landing Spots (Vines + Menus + Steam)
            const corners = [ { id: 'tl', x: 20, y: 20 }, { id: 'tr', x: dialogueBox.offsetWidth - 40, y: 20 }, { id: 'bl', x: 20, y: dialogueBox.offsetHeight - 40 }, { id: 'br', x: dialogueBox.offsetWidth - 40, y: dialogueBox.offsetHeight - 40 } ];
            
            // Add Menu Buttons as Targets
            const menuBtns = document.querySelectorAll('.menu-btn');
            const menuTargets = [];
            menuBtns.forEach(btn => {
                const rect = btn.getBoundingClientRect();
                const boxRect = dialogueBox.getBoundingClientRect(); // relative to box? No, absolute for flight
                // Just store absolute targets for now
            });
            
            // Simplified: If Idle -> Target Steam Button specifically
            let targetType = 'vine';
            let targetX, targetY;
            const steamBtn = document.querySelector('.btn-steam');

            if (isIdle && steamBtn && Math.random() > 0.3) {
                // High chance to target steam if idle
                const rect = steamBtn.getBoundingClientRect();
                targetX = rect.left + rect.width - 20; // Corner of button
                targetY = rect.top;
                targetType = 'steam';
            } else {
                // Vine corner relative to Dialogue Box
                const targetCorner = corners[Math.floor(Math.random() * corners.length)];
                const boxRect = dialogueBox.getBoundingClientRect();
                targetX = boxRect.left + targetCorner.x + (Math.random() * 40 - 20); 
                targetY = boxRect.top + targetCorner.y + (Math.random() * 40 - 20);
            }

            const startX = Math.random() * window.innerWidth; 
            const startY = Math.random() * window.innerHeight;
            b.style.left = startX + 'px'; 
            b.style.top = startY + 'px';
            
            document.body.appendChild(b);

            // 1. Fly to Target (6s = Slower)
            requestAnimationFrame(() => {
                b.style.left = targetX + 'px';
                b.style.top = targetY + 'px';
                const angle = Math.atan2(targetY - startY, targetX - startX) * 180 / Math.PI;
                b.style.transform = `rotate(${angle + 90}deg) scale(0.8)`;
            });

            // 2. Land
            setTimeout(() => {
                b.classList.add('landed'); 
                // Adjust rotation to sit properly
                b.style.transform = `rotate(${Math.random() * 360}deg) scale(0.8)`;
                
                // 3. Wait & Take off
                const waitTime = targetType === 'steam' ? 4000 : 5000 + Math.random() * 4000;
                
                setTimeout(() => {
                    b.classList.remove('landed');
                    const exitX = targetX + (Math.random() - 0.5) * 500; 
                    const exitY = targetY - 500;
                    b.style.left = exitX + 'px';
                    b.style.top = exitY + 'px';
                    b.style.opacity = '0';
                    setTimeout(() => b.remove(), 6000);
                }, waitTime);
            }, 6000); // 6s Flight duration
        }

        // --- ROSE PETAL SYSTEM ---
        function spawnPetal() {
            const p = document.createElement('div'); const colors = ['pink', 'red', 'maroon']; p.classList.add('petal', colors[Math.floor(Math.random() * colors.length)]);
            const startLeft = Math.random() * 100; const fallDuration = 10 + Math.random() * 10; const swayDuration = 3 + Math.random() * 3;
            p.style.left = startLeft + 'vw'; p.style.width = (6 + Math.random() * 8) + 'px'; p.style.height = p.style.width;
            p.style.animationDuration = `${fallDuration}s, ${swayDuration}s`;
            document.body.appendChild(p); setTimeout(() => { p.remove(); }, fallDuration * 1000);
        }

        window.onload = () => {
            initLanguage(); 
            const ui = document.getElementById('game-ui'); if (ui) ui.classList.add('ready');
            startAutoTalk();
            resetIdleTimer(); // Start idle watch
            // Rose petals system removed
            setInterval(() => {
                const ember = document.createElement('div'); 
                ember.className = 'ember'; 
                ember.style.left = Math.random() * 100 + 'vw'; 
                // Randomize duration for varied speed (slower = more firefly-like)
                ember.style.animationDuration = (Math.random() * 4 + 6) + 's'; 
                document.body.appendChild(ember); 
                setTimeout(() => ember.remove(), 10000);
            }, 200); // Spawn slightly more frequent to compensate for short life
        };
        window.onclick = (e) => { 
            resetIdleTimer(); 
            if (e.target.classList.contains('modal')) {
                if (e.target.id === 'video-modal') closeVideoModal();
                else closeModals();
            }
        }; 
        window.ontouchstart = (e) => { 
            resetIdleTimer(); 
            if (e.target.classList.contains('modal')) {
                if (e.target.id === 'video-modal') closeVideoModal();
                else closeModals();
            }
        };
    </script>
</body>
</html>