<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Arcane Merchant | Shop Management Sim</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --dark-bg: rgba(15, 15, 20, 0.98);
            --parchment: #f4e4bc;
            --ui-font: 'Cinzel', serif;
            --dialogue-font: 'Crimson Text', serif;
            --transition-speed: 0.8s;
            --magical-glow: 0 0 20px rgba(212, 175, 55, 0.4);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: #050505;
            color: #fff;
            position: fixed;
        }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('images/desktop-bg.webp?v=final_fix') no-repeat center center;
            background-size: cover;
            z-index: -1;
            filter: brightness(0.7) sepia(0.1);
            animation: slowZoom 40s linear infinite alternate;
            will-change: transform;
        }

        @keyframes slowZoom {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.6) 100%);
            pointer-events: none;
            z-index: 0;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            padding: 40px;
            opacity: 0;
            transition: opacity 1.5s ease-in;
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .game-container.ready {
            opacity: 1;
            display: flex !important;
        }

        .branding-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: var(--ui-font);
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
            z-index: 20;
            margin-bottom: 30px;
        }

        .official-logo {
            max-width: 450px;
            width: 95%;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 0 20px rgba(212, 175, 55, 0.6)) drop-shadow(0 0 40px rgba(212, 175, 55, 0.2));
            margin-bottom: 5px;
            display: block;
        }

        .branding-container p {
            font-style: italic;
            font-size: 0.9rem;
            color: #ccc;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-align: center;
        }

        .menu-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 10;
            width: 350px !important;
            margin-left: auto !important;
            margin-right: auto !important;
            margin-bottom: 40px;
            justify-content: center;
        }

        .menu-btn {
            background: var(--dark-bg);
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: var(--gold);
            padding: 14px 30px;
            font-family: var(--ui-font);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            text-align: center;
            text-decoration: none;
            display: block;
            width: 100%;
        }

        .menu-btn:hover {
            border-color: var(--gold);
            background: rgba(212, 175, 55, 0.1);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
        }

        .dialogue-wrapper {
            width: 100%;
            max-width: 900px;
            position: relative;
            transform: translateY(0);
            transition: transform 0.5s ease;
            text-align: left;
        }

        .dialogue-box {
            background: var(--dark-bg);
            border: 2px solid rgba(212, 175, 55, 0.5);
            padding: 30px 40px;
            min-height: 150px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
            border-radius: 2px;
        }

        .findie-logo-fixed {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0.8;
            transition: all 0.4s ease;
            text-decoration: none;
            color: var(--gold);
            font-family: var(--ui-font);
            font-size: 0.75rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 10px 15px;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .findie-logo-fixed:hover {
            opacity: 1;
            filter: drop-shadow(0 0 15px rgba(212, 175, 55, 0.6));
            transform: translateY(-2px);
            border-color: rgba(212, 175, 55, 1);
        }

        .studio-logo {
            height: 35px;
            width: auto;
            filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.4));
        }

        .speaker-name {
            position: absolute;
            top: -14px;
            left: 30px;
            background: var(--gold);
            color: #000;
            padding: 3px 18px;
            font-family: var(--ui-font);
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }

        .game-icon-seal {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        .dialogue-text {
            font-family: var(--dialogue-font);
            font-size: 1.6rem;
            line-height: 1.5;
            color: #f0f0f0;
            min-height: 1.5em;
        }

        .dialogue-text::after {
            content: "|";
            animation: blink 1s step-end infinite;
            margin-left: 5px;
            color: var(--gold);
        }

        @keyframes blink {
            from, to { opacity: 1; }
            50% { opacity: 0; }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 100;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .modal.visible {
            display: flex;
            opacity: 1;
        }

        .parchment {
            background: var(--parchment);
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            color: #2c1e0f;
            width: 95%;
            max-width: 750px;
            padding: 40px;
            border-radius: 3px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.7), inset 0 0 60px rgba(139, 69, 19, 0.2);
            position: relative;
            font-family: var(--dialogue-font);
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            -webkit-overflow-scrolling: touch;
        }

        .modal.visible .parchment {
            transform: scale(1);
        }

        .parchment h2 {
            font-family: var(--ui-font);
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(139, 69, 19, 0.3);
            padding-bottom: 12px;
            color: #5d2e0a;
            text-align: center;
            letter-spacing: 2px;
        }

        .carousel-container {
            position: relative;
            width: 100%;
            height: 650px;
            margin: 20px 0;
            overflow: hidden;
            border: 3px double #5d2e0a;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.25) 0%, rgba(0,0,0,0.4) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.5), 0 15px 40px rgba(0,0,0,0.6);
            border-radius: 8px;
        }

        .carousel-image {
            position: absolute;
            width: 90%;
            height: 90%;
            object-fit: contain;
            margin: auto;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            opacity: 0;
            transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out, filter 0.8s ease-in-out;
            filter: drop-shadow(0 0 20px rgba(212, 175, 55, 0)) brightness(0.8);
            will-change: opacity, transform, filter;
            z-index: 1;
        }

        .carousel-image.active {
            opacity: 1;
            z-index: 2;
            transform: translate(-50%, -50%) scale(1);
            filter: drop-shadow(0 15px 35px rgba(0,0,0,0.7)) brightness(1.1) drop-shadow(0 0 15px rgba(212, 175, 55, 0.4));
        }

        .loading-glyph {
            position: absolute;
            width: 50px;
            height: 50px;
            border: 3px solid rgba(212, 175, 55, 0.1);
            border-top: 3px solid var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 0;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .carousel-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(139, 69, 19, 0.2);
            border: 1px solid rgba(139, 69, 19, 0.4);
            color: #5d2e0a;
            font-size: 2.5rem;
            cursor: pointer;
            z-index: 10;
            opacity: 0.7;
            transition: all 0.3s;
            font-family: serif;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .carousel-arrow:hover {
            opacity: 1;
            background: rgba(212, 175, 55, 0.3);
            color: #5d2e0a;
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-arrow.prev { left: 20px; }
        .carousel-arrow.next { right: 20px; }

        .rumor-item {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed rgba(139, 69, 19, 0.2);
        }

        .community-links {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .community-item {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: #2c1e0f;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            padding: 10px;
            background: rgba(139, 69, 19, 0.05);
            border-radius: 4px;
        }

        .community-item:hover {
            background: rgba(139, 69, 19, 0.12);
            transform: translateY(-2px);
        }

        .community-icon {
            font-size: 1.4rem;
        }

        @media (max-width: 768px) {
            .background {
                background-image: url('images/desktop-bg.webp?v=final_fix');
                animation: slowZoom 40s linear infinite alternate;
                transform: scale(1);
            }

            .game-container {
                padding: 20px;
                justify-content: center;
                align-items: center;
            }

            .official-logo {
                max-width: 280px;
            }

            .menu-container {
                gap: 10px;
                margin-bottom: 25px;
                max-width: 280px;
            }

            .menu-btn {
                padding: 10px 15px;
                font-size: 0.85rem;
            }

            .dialogue-box {
                padding: 20px;
                min-height: 120px;
            }

            .dialogue-text {
                font-size: 1.1rem;
            }

            .parchment {
                padding: 30px 20px;
            }

            .carousel-container {
                height: 350px;
            }

            .community-links {
                grid-template-columns: 1fr;
            }

            .findie-logo-fixed {
                position: fixed;
                top: 15px;
                right: 15px;
                transform: none;
                padding: 6px 12px;
                font-size: 0.65rem;
                background: rgba(0, 0, 0, 0.8);
                z-index: 1000;
                width: max-content;
            }

            .studio-logo {
                height: 25px;
            }
        }

        @media (max-height: 700px) {
            .game-container {
                justify-content: flex-start;
                padding-top: 20px;
                overflow-y: auto;
            }
            .official-logo { max-width: 200px; }
            .menu-container { gap: 8px; margin-bottom: 15px; }
            .menu-btn { padding: 8px 12px; font-size: 0.8rem; }
            .dialogue-box { min-height: 100px; padding: 15px; }
        }
    </style>
</head>
<body>

    <div class="background"></div>
    <div class="overlay"></div>

    <div id="game-ui" class="game-container">
        
        <div class="branding-container">
            <img src="images/official_logo.png" alt="Arcane Merchant Logo" class="official-logo">
            <p>MEDIEVAL FANTASY SHOP SIMULATOR ‚Ä¢ APRIL 10 2026</p>
        </div>

        <div class="menu-container">
            <button class="menu-btn" onclick="handleWatch()">Watch Chronicles</button>
            <button class="menu-btn" onclick="handleWares()">Browse Wares</button>
            <button class="menu-btn" onclick="handleRumors()">Ask Rumors</button>
            <button class="menu-btn" onclick="handleCommunity()">The Common Room</button>
            <button class="menu-btn" onclick="handleFeatures()">Shop Systems</button>
            <a href="https://store.steampowered.com/app/4086760/Arcane_Merchant/" target="_blank" class="menu-btn" style="color: #fff; background: linear-gradient(135deg, #1b2838 0%, #2a475e 100%); border-color: #66c0f4; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <img src="images/steam_logo_official.jpg?v=final" width="24" height="24" style="border-radius: 50%;">
                Wishlist on Steam
            </a>
        </div>

        <div class="dialogue-wrapper">
            <div class="dialogue-box">
                <div class="speaker-name">
                    <img src="images/arcane_initial_logo.jpg" class="game-icon-seal" alt="Seal">
                    Master Merchant
                </div>
                <div id="dialogue" class="dialogue-text"></div>
            </div>
        </div>

        <a href="https://findiestudios.com" target="_blank" class="findie-logo-fixed">
            <span>¬© 2026 Findie Studios</span>
            <img src="images/findie_logo.webp" class="studio-logo" alt="Findie Studios Logo">
        </a>
    </div>

    <div id="wares-modal" class="modal">
        <div class="parchment" style="max-width: 900px; width: 95vw;">
            <span class="close-modal" onclick="closeModals()">&times;</span>
            <h2 style="font-size: 2.2rem; text-shadow: 0 0 10px rgba(212, 175, 55, 0.2);">Manifest of Wonders</h2>
            
            <p style="font-style: italic; margin-bottom: 25px; text-align: center; font-size: 1.2rem; color: #5d2e0a; line-height: 1.5; padding: 0 20px;">
                "Step closer, traveler... Behold my collection of rare artifacts, harvested from the forgotten corners of the realm."
            </p>

            <div class="carousel-container">
                <div class="loading-glyph"></div>
                <button class="carousel-arrow prev" onclick="moveCarousel(-1)">‚ùÆ</button>
                <div id="carousel-track" style="width: 100%; height: 100%; position: relative;">
                    <!-- Images will be injected here -->
                </div>
                <button class="carousel-arrow next" onclick="moveCarousel(1)">‚ùØ</button>
            </div>
            
            <p id="artifact-description" style="text-align: center; font-size: 1.1rem; margin-top: 20px; color: #5d2e0a; font-weight: bold; letter-spacing: 3px; text-transform: uppercase; animation: magicalPulse 2s ease-in-out infinite;">
                ‚úß Magically Discovered ‚úß
            </p>
        </div>
    </div>

    <div id="rumors-modal" class="modal">
        <div class="parchment">
            <span class="close-modal" onclick="closeModals()">&times;</span>
            <h2>Whispers from the Void</h2>
            <p style="font-style: italic; margin-bottom: 25px; text-align: center;">"Information is the only currency that never loses its value."</p>
            
            <div class="rumor-item">
                <p><strong>‚úß The Lost Caravan:</strong> Rumor has it a shipment of Star-Iron was lost in the Whispering Woods. Finders, keepers, they say...</p>
            </div>
            <div class="rumor-item">
                <p><strong>‚úß The King's Debt:</strong> The crown is looking for a specific relic to settle a debt with the Iron Bank. High risk, higher reward.</p>
            </div>
            <div class="rumor-item">
                <p><strong>‚úß Celestial Alignment:</strong> The stars suggest that next month, moon-blessed artifacts will triple in potency‚Äîand price.</p>
            </div>
        </div>
    </div>

    <div id="community-modal" class="modal">
        <div class="parchment">
            <span class="close-modal" onclick="closeModals()">&times;</span>
            <h2>The Common Room</h2>
            <p style="font-style: italic; margin-bottom: 20px; text-align: center;">"Where the ravens gather and the scrolls of the world are shared."</p>
            
            <div class="community-links">
                <a href="https://www.findiestudios.com/" target="_blank" rel="noopener noreferrer" class="community-item">
                    <span class="community-icon">üè∞</span>
                    <span>Findie Studios</span>
                </a>
                <a href="https://discord.gg/findiestudios" target="_blank" rel="noopener noreferrer" class="community-item">
                    <span class="community-icon">‚öîÔ∏è</span>
                    <span>Discord</span>
                </a>
                <a href="https://x.com/FindieStudios" target="_blank" rel="noopener noreferrer" class="community-item">
                    <span class="community-icon">üìú</span>
                    <span>X / Twitter</span>
                </a>
                <a href="https://www.youtube.com/@FindieStudios" target="_blank" rel="noopener noreferrer" class="community-item">
                    <span class="community-icon">üõ°Ô∏è</span>
                    <span>YouTube</span>
                </a>
                <a href="https://www.instagram.com/findiestudios" target="_blank" rel="noopener noreferrer" class="community-item">
                    <span class="community-icon">üè∫</span>
                    <span>Instagram</span>
                </a>
                <a href="https://www.tiktok.com/@findiestudios" target="_blank" rel="noopener noreferrer" class="community-item">
                    <span class="community-icon">üé≠</span>
                    <span>TikTok</span>
                </a>
                <a href="https://www.reddit.com/r/arcanemerchant" target="_blank" rel="noopener noreferrer" class="community-item">
                    <span class="community-icon">‚öíÔ∏è</span>
                    <span>Reddit</span>
                </a>
                <a href="https://www.linkedin.com/company/findiestudios" target="_blank" rel="noopener noreferrer" class="community-item">
                    <span class="community-icon">üóùÔ∏è</span>
                    <span>LinkedIn</span>
                </a>
            </div>
        </div>
    </div>

    <div id="features-modal" class="modal">
        <div class="parchment">
            <span class="close-modal" onclick="closeModals()">&times;</span>
            <h2>Mastering the Arcane Arts</h2>
            <p style="font-style: italic; margin-bottom: 25px; text-align: center;">"A true merchant does more than just trade‚Äîthey shape the world around them."</p>
            
            <div class="rumor-item">
                <p><strong>‚úß Grand Display:</strong> Design a sanctuary for your wares. The placement of a single enchanted gem can entice a king or ward off a thief.</p>
            </div>
            <div class="rumor-item">
                <p><strong>‚úß Alchemy & Crafting:</strong> Transform raw essence into legendary artifacts. Your workbench is where myths are forged.</p>
            </div>
            <div class="rumor-item">
                <p><strong>‚úß Dynamic Economy:</strong> The world is alive. Wars, plagues, and festivals shift the value of your inventory in real-time.</p>
            </div>
            <div class="rumor-item">
                <p><strong>‚úß Staffing & Security:</strong> Hire apprentices to mind the counter and gargoyles to watch the shadows.</p>
            </div>
        </div>
    </div>

    <div id="video-modal" class="modal">
        <div class="parchment" style="max-width: 900px; background: #0a0a0a; color: var(--gold); padding: 20px; border: 2px solid var(--gold);">
            <span class="close-modal" onclick="closeVideoModal()">&times;</span>
            <h2 style="color: var(--gold); border-bottom-color: var(--gold);">Chronicles of the Merchant</h2>
            <div class="video-container">
                <video id="video-player" controls muted playsinline></video>
            </div>
        </div>
    </div>

    <script>
        const dialogueElement = document.getElementById('dialogue');
        const welcomeText = "Step into the warmth, traveler. Every coin traded is a signal. Will you strengthen the town's infrastructure, or seek to redefine the calculus of your own reward?";
        
        const merchantDialogues = [
            "Traders from the distant realms arrive without warning and vanish like mist. Timing is the only magic that truly matters here.",
            "In these lands, Fame is a functional currency‚Äîmore potent than gold. A high reputation opens doors that keys cannot touch.",
            "In economic downturns, your reputation is your shield. Social trust is the only armor that softens a market-wide recession.",
            "The Void is cold, but my hearth is always lit. I see you have an eye for the extraordinary...",
            "Behold my collection of rare artifacts... each item tells a tale, and some... well, they might just choose you.",
            "Low fame may relegate you to the shadows, but remember: the greatest arbitrage often hides where no one else dares to look.",
            "When guilds unite, even the town's policies bend. Will you seek collective action, or let the 'Invisible Hand' guide your fate?",
            "No two shops are alike. Seek differentiation, find your niche, and hunt for 'hero' artifacts that carry an outsized cachet.",
            "The market never sleeps. A savvy merchant anticipates the cycle before the first ripple appears on the surface."
        ];

        let currentDialogueIndex = 0;
        let typeTimeout;
        let isTyping = false;
        let hls;

        function handleWatch() {
            playSFX('click');
            showVideoModal();
            typeWriter("Behold the memories of the trade... visions of what was and what is yet to come.", dialogueElement, 30);
        }

        function showVideoModal() {
            const modal = document.getElementById('video-modal');
            const video = document.getElementById('video-player');
            const videoSrc = 'https://video.fastly.steamstatic.com/store_trailers/4086760/1025836541/d1d348ada576efe61787479707370305904dfecb/1769431428/hls_264_master.m3u8';

            modal.classList.add('visible');
            
            if (typeof Hls === 'undefined') {
                const script = document.createElement('script');
                script.src = "https://cdn.jsdelivr.net/npm/hls.js@latest";
                script.onload = () => initHls(video, videoSrc);
                document.head.appendChild(script);
            } else {
                initHls(video, videoSrc);
            }
        }

        function initHls(video, videoSrc) {
            if (Hls.isSupported()) {
                if (hls) {
                    hls.destroy();
                }
                hls = new Hls();
                hls.loadSource(videoSrc);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    video.play().catch(e => console.log("Auto-play prevented or failed", e));
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = videoSrc;
                video.addEventListener('loadedmetadata', function() {
                    video.play().catch(e => console.log("Auto-play prevented or failed", e));
                });
            }
        }

        function closeVideoModal() {
            const video = document.getElementById('video-player');
            video.pause();
            closeModals();
        }

        function typeWriter(text, element, speed = 35, callback) {
            if (isTyping) {
                clearTimeout(typeTimeout);
            }
            
            isTyping = true;
            element.innerHTML = "";
            let i = 0;

            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    typeTimeout = setTimeout(type, speed);
                } else {
                    isTyping = false;
                    if (callback) callback();
                }
            }
            type();
        }

        function playSFX(type) {
            console.log("Playing SFX: " + type);
        }

        function handleWares() {
            playSFX('click');
            showModal('wares-modal');
            initCarousel();
            typeWriter("Behold my collection of rare artifacts... each item tells a tale, and some... well, they might just choose you.", dialogueElement, 30);
        }

        function handleRumors() {
            playSFX('click');
            showModal('rumors-modal');
            typeWriter("The walls have ears, and the wind has a tongue. In these dark times, a whisper can be worth more than a pouch of diamonds.", dialogueElement, 30);
        }

        function handleCommunity() {
            playSFX('click');
            showModal('community-modal');
            typeWriter("How can you stay updated, you ask? The ravens carry our news, and the common rooms are always bustling with talk of our upcoming wares.", dialogueElement, 30);
        }

        function handleFeatures() {
            playSFX('click');
            showModal('features-modal');
            typeWriter("Being a merchant is more than just counting gold. It is an art of logistics, a dance of pricing, and the crafting of a sanctuary.", dialogueElement, 30);
        }

        function showModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.classList.add('visible');
        }

        function cycleDialogue() {
            if (isTyping) return;
            currentDialogueIndex = (currentDialogueIndex + 1) % merchantDialogues.length;
            typeWriter(merchantDialogues[currentDialogueIndex], dialogueElement, 35);
        }

        function closeModals() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('visible'));
            stopC();
            setTimeout(() => {
                cycleDialogue();
            }, 400);
        }

        let carouselImages = [];
        for (let i = 1; i <= 18; i++) {
            carouselImages.push(`images/inventory/inventory_${i}.jpg?v=final_fix`);
        }
        
        let currentCarouselIndex = 0;
        let carouselInterval;
        let carouselInitialized = false;

        function initCarousel() {
            const track = document.getElementById('carousel-track');
            if (!track || carouselInitialized) {
                if (carouselInitialized) startC();
                return;
            }
            
            track.innerHTML = '';
            
            carouselImages.forEach((src, index) => {
                const img = document.createElement('img');
                img.src = src;
                img.className = 'carousel-image' + (index === 0 ? ' active' : '');
                img.alt = "Mystical Ware";
                img.loading = "lazy";
                track.appendChild(img);
            });
            
            carouselInitialized = true;
            startC();
        }

        function startC() {
            stopC();
            showCarouselImage(Math.floor(Math.random() * carouselImages.length));
            carouselInterval = setInterval(() => {
                let nextIndex;
                do {
                    nextIndex = Math.floor(Math.random() * carouselImages.length);
                } while (nextIndex === currentCarouselIndex);
                showCarouselImage(nextIndex);
            }, 4000);
        }

        function stopC() {
            if (carouselInterval) clearInterval(carouselInterval);
        }

        function showCarouselImage(index) {
            const images = document.querySelectorAll('.carousel-image');
            if (images.length === 0) return;
            
            images.forEach(img => img.classList.remove('active'));
            currentCarouselIndex = (index + images.length) % images.length;
            if (images[currentCarouselIndex]) {
                images[currentCarouselIndex].classList.add('active');
            }
        }

        function moveCarousel(step) {
            stopC();
            showCarouselImage(currentCarouselIndex + step);
            startC();
        }

        window.onload = () => {
            setTimeout(() => {
                const ui = document.getElementById('game-ui');
                if (ui) ui.classList.add('ready');
                setTimeout(() => {
                    typeWriter(welcomeText, dialogueElement, 40);
                    setInterval(cycleDialogue, 12000);
                }, 800);
            }, 500);
        };

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                closeVideoModal();
            }
        }
        window.ontouchstart = function(event) {
            if (event.target.classList.contains('modal')) {
                closeVideoModal();
            }
        }
    </script>
</body>
</html>