<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Arcane Merchant | Shop Management Sim</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --dark-bg: rgba(15, 15, 20, 0.98);
            --parchment: #f4e4bc;
            --ui-font: 'Cinzel', serif;
            --dialogue-font: 'Crimson Text', serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body, html { height: 100%; width: 100%; overflow: hidden; background-color: #050505; color: #fff; position: fixed; }

        .background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #050505 url('images/official-background.jpg?v=final_fix') no-repeat center center !important;
            background-size: cover !important; z-index: -1; filter: brightness(0.8) sepia(0.1);
            animation: slowZoom 60s linear infinite alternate;
        }
        @keyframes slowZoom { from { transform: scale(1); } to { transform: scale(1.15); } }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.6) 100%); pointer-events: none; z-index: 0; }
        .warm-overlay { position: fixed; bottom: 0; left: 0; width: 100%; height: 60%; background: radial-gradient(ellipse at bottom, rgba(255, 160, 60, 0.15) 0%, rgba(100, 50, 0, 0.05) 40%, transparent 80%); z-index: 0; pointer-events: none; mix-blend-mode: screen; }

        /* UI Elements */
        .lang-toggle { position: fixed; top: 10px; left: 10px; z-index: 1000; background: transparent; border: none; padding: 5px; cursor: pointer; transition: all 0.3s ease; font-size: 1.5rem; filter: drop-shadow(0 0 5px rgba(212, 175, 55, 0.6)); }
        .lang-toggle:hover { transform: scale(1.1) rotate(5deg); }
        .game-container { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; width: 100vw; padding: 40px; opacity: 0; transition: opacity 1.5s ease-in; position: relative; z-index: 1; text-align: center; }
        .game-container.ready { opacity: 1; display: flex !important; }
        .branding-container { display: flex; flex-direction: column; align-items: center; margin-bottom: 25px; z-index: 20; }
        .official-logo { max-width: 450px; width: 95%; height: auto; filter: drop-shadow(0 0 20px rgba(212,175,55,0.6)); margin-bottom: 5px; }
        .branding-container p { font-family: var(--ui-font); font-style: italic; font-size: 0.9rem; color: #ccc; letter-spacing: 2px; margin-top: 10px; }
        .menu-container { display: flex; flex-direction: column; gap: 12px; z-index: 2000; width: 350px !important; margin: 0 auto 40px auto; position: relative; pointer-events: auto; }
        .menu-btn { background: rgba(10, 10, 15, 0.4); backdrop-filter: blur(5px); border: 3px double rgba(212, 175, 55, 0.6); border-radius: 4px; color: var(--gold); padding: 14px 30px; font-family: var(--ui-font); font-size: 1rem; cursor: pointer; transition: all 0.4s ease; text-transform: uppercase; letter-spacing: 2px; width: 100%; pointer-events: auto !important; z-index: 2001; }
        .menu-btn:hover { border-color: var(--gold); background: rgba(212, 175, 55, 0.15); transform: scale(1.02); }

        /* DIALOGUE BOX & FRAME */
        .dialogue-wrapper { width: 100%; max-width: 900px; position: relative; transform: translateY(0); transition: transform 0.5s ease; text-align: left; }
        .dialogue-box { background: rgba(10, 10, 15, 0.9); border: 3px double #d4af37; padding: 40px 50px; min-height: 160px; position: relative; box-shadow: 0 10px 50px rgba(0,0,0,1), inset 0 0 60px rgba(0,0,0,0.8); border-radius: 4px; overflow: visible; }
        .dialogue-text { font-family: var(--dialogue-font); font-size: 1.8rem; line-height: 1.5; color: #fceeb5; text-shadow: 0 2px 4px rgba(0,0,0,1); position: relative; z-index: 60; }
        .dialogue-text::after { content: "|"; animation: blink 1s step-end infinite; color: var(--gold); margin-left: 5px; }
        .speaker-name { position: absolute; top: -16px; left: 40px; background: #d4af37; color: #000; padding: 4px 20px; font-family: var(--ui-font); font-weight: bold; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.6); z-index: 100; border: 1px solid #fff; }
        .game-icon-seal { width: 24px; height: 24px; object-fit: contain; }

        /* VINES */
        .vine-frame { position: absolute; pointer-events: none; z-index: 50; filter: drop-shadow(2px 4px 4px rgba(0,0,0,0.8)); }
        .vine-tl { top: -25px; left: -25px; width: 180px; height: 180px; }
        .vine-tr { top: -25px; right: -25px; width: 180px; height: 180px; transform: scaleX(-1); }
        .vine-bl { bottom: -25px; left: -25px; width: 180px; height: 180px; transform: scaleY(-1); }
        .vine-br { bottom: -25px; right: -25px; width: 180px; height: 180px; transform: scale(-1); }
        .stem-path { stroke-dasharray: 1500; stroke-dashoffset: 1500; animation: growStem 4s ease-out forwards; }
        .leaf { opacity: 0; transform-origin: center; transform: scale(0); animation: bloom 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .flower { opacity: 0; transform-origin: center; transform: scale(0); animation: bloom 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        @keyframes growStem { to { stroke-dashoffset: 0; } }
        @keyframes bloom { to { opacity: 1; transform: scale(1); } }
        .d-1 { animation-delay: 0.2s; } .d-2 { animation-delay: 0.6s; } .d-3 { animation-delay: 1.0s; } .d-4 { animation-delay: 1.4s; } .d-5 { animation-delay: 1.8s; } .d-6 { animation-delay: 2.2s; }

        /* --- REFINED MAJESTIC BUTTERFLY --- */
        .butterfly {
            position: absolute;
            width: 20px; /* Base size */
            height: 20px;
            z-index: 70; /* Above vines */
            pointer-events: none;
            /* Use 3D transform for realistic wing flap */
            transform-style: preserve-3d;
            will-change: transform, top, left;
            transition: top 4s ease-in-out, left 4s ease-in-out, transform 1s ease-in-out; /* Smooth flight */
        }

        .butterfly-body {
            position: absolute;
            top: 50%; left: 50%;
            width: 4px; height: 14px;
            background: #222;
            border-radius: 5px;
            transform: translate(-50%, -50%);
        }

        .wing {
            position: absolute;
            top: 0;
            width: 14px; height: 22px;
            border-radius: 50% 50% 10% 50%;
            opacity: 0.9;
            filter: drop-shadow(0 0 4px currentColor);
            /* Correct Pivot Points for realistic flapping */
        }

        .wing.left {
            right: 50%; /* Anchor to center */
            transform-origin: 100% 50%; /* Pivot on right edge (body) */
            animation: flapLeft 0.15s infinite alternate ease-in-out;
        }

        .wing.right {
            left: 50%; /* Anchor to center */
            transform-origin: 0% 50%; /* Pivot on left edge (body) */
            transform: scaleX(-1);
            animation: flapRight 0.15s infinite alternate ease-in-out;
        }

        /* Butterfly Colors */
        .bt-gold { color: #ffd700; } .bt-gold .wing { background: radial-gradient(circle at 30% 30%, #ffd700, #ff8c00); }
        .bt-blue { color: #00bfff; } .bt-blue .wing { background: radial-gradient(circle at 30% 30%, #00bfff, #1e90ff); }
        .bt-purple { color: #e056fd; } .bt-purple .wing { background: radial-gradient(circle at 30% 30%, #e056fd, #8e44ad); }

        /* Majestic Flapping Animations */
        @keyframes flapLeft {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(60deg); }
        }
        @keyframes flapRight {
            0% { transform: scaleX(-1) rotateY(0deg); }
            100% { transform: scaleX(-1) rotateY(60deg); }
        }

        /* Landed State: Slow Flap */
        .butterfly.landed .wing {
            animation-duration: 3s; /* Very slow, majestic breathing */
        }

        /* --- ROSE PETAL SYSTEM --- */
        .petal { position: fixed; top: -20px; z-index: 25; pointer-events: none; opacity: 0.9; border-radius: 50% 0 50% 50%; background: linear-gradient(135deg, var(--petal-color), rgba(0,0,0,0.1)); animation: fall linear forwards; }
        .petal.pink { --petal-color: #ffb7c5; } .petal.red { --petal-color: #dc143c; } .petal.maroon { --petal-color: #800020; }
        @keyframes fall { to { top: 110vh; transform: translateY(0) rotate(720deg); } }

        /* Modals & Layout */
        .findie-logo-fixed { position: fixed; top: 10px; right: 10px; display: flex; align-items: center; gap: 8px; opacity: 0.95; transition: all 0.4s; text-decoration: none; color: var(--gold); font-family: var(--ui-font); font-size: 0.6rem; padding: 6px 12px; border-radius: 4px; background: rgba(0,0,0,0.85); z-index: 9999; border: 1px solid rgba(212,175,55,0.6); }
        .findie-logo-fixed:hover { opacity: 1; transform: translateY(-2px); border-color: #fff; }
        .copyright-footer { position: fixed; bottom: 5px; width: 100%; text-align: center; font-family: var(--ui-font); font-size: 0.5rem; color: rgba(255,255,255,0.3); text-transform: uppercase; z-index: 500; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 2000; justify-content: center; align-items: center; padding: 20px; opacity: 0; transition: opacity 0.5s; }
        .modal.visible { display: flex; opacity: 1; }
        .parchment { background: var(--parchment); color: #2c1e0f; width: 95%; max-width: 750px; padding: 40px; border-radius: 3px; box-shadow: 0 20px 50px rgba(0,0,0,0.7); position: relative; font-family: var(--dialogue-font); max-height: 90vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.4s; }
        .modal.visible .parchment { transform: scale(1); }
        .close-modal { position: absolute; top: 15px; left: 20px; font-size: 2.5rem; cursor: pointer; color: #8b4513; z-index: 10; }
        .story-container { position: relative; width: 100%; height: 80vh; max-height: 800px; display: flex; flex-direction: column; }
        .story-progress { position: absolute; top: 10px; left: 0; width: 100%; display: flex; gap: 4px; padding: 0 10px; z-index: 20; }
        .story-bar { flex: 1; height: 3px; background: rgba(255,255,255,0.3); border-radius: 2px; overflow: hidden; }
        .story-bar-fill { height: 100%; width: 0%; background: #fff; transition: width 0.2s linear; }
        .story-bar.active .story-bar-fill { width: 100%; } .story-bar.seen .story-bar-fill { width: 100%; }
        .story-header { position: absolute; top: 25px; left: 55px; display: flex; align-items: center; gap: 10px; z-index: 20; }
        .story-avatar { width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--gold); }
        .story-info { display: flex; flex-direction: column; }
        .story-username { color: #fff; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.9); }
        .story-time { color: rgba(255,255,255,0.9); font-size: 0.75rem; text-shadow: 0 2px 4px rgba(0,0,0,0.9); }
        .story-content { position: relative; flex: 1; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .story-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; filter: blur(20px) brightness(0.6); opacity: 0.6; transform: scale(1.1); }
        .story-img-main { position: relative; width: 100%; max-width: 400px; aspect-ratio: 1/1; object-fit: contain; z-index: 2; box-shadow: 0 0 30px rgba(0,0,0,0.5); border-radius: 8px; }
        .tap-zone { position: absolute; top: 0; height: 100%; width: 35%; z-index: 10; cursor: pointer; } .tap-zone.left { left: 0; } .tap-zone.right { right: 0; }
        .video-container { position: relative; width: 100%; padding-top: 56.25%; background: #000; border: 4px solid var(--gold); }
        video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; }
        .community-links { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .community-item { display: flex; align-items: center; gap: 10px; text-decoration: none; color: #2c1e0f; font-size: 1.1rem; padding: 10px; background: rgba(139,69,19,0.05); border-radius: 4px; transition: all 0.3s; }
        .community-item:hover { background: rgba(139,69,19,0.12); transform: translateY(-2px); }

        @media (max-width: 768px) {
            .game-container { padding-top: 20px; padding-bottom: 180px; overflow-y: auto; display: block !important; }
            .official-logo { max-width: 240px; }
            .menu-container { width: 85% !important; margin-bottom: 30px; }
            .dialogue-wrapper { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 94%; margin: 0; }
            .dialogue-box { padding: 25px 20px; min-height: 120px; }
            .dialogue-text { font-size: 1.1rem; }
            .speaker-name { top: -12px; left: 20px; font-size: 0.65rem; padding: 3px 15px; }
            .vine-tl, .vine-tr, .vine-bl, .vine-br { width: 100px; height: 100px; }
        }
    </style>
</head>
<body>
    <div class="background"></div><div class="overlay"></div><div class="warm-overlay"></div>
    <div class="lang-toggle" onclick="showModal('lang-modal')" title="Select Region"><span style="font-size: 1.5rem;">üó∫Ô∏è</span></div>

    <div id="game-ui" class="game-container">
        <div class="branding-container">
            <img src="images/official_logo.png" alt="Arcane Merchant Logo" class="official-logo">
            <p>MEDIEVAL FANTASY SHOP SIMULATOR ‚Ä¢ APRIL 10 2026 RELEASE!</p>
        </div>
        <div class="menu-container"><button class="menu-btn">Loading...</button></div>

        <div class="dialogue-wrapper">
            <div class="dialogue-box">
                <!-- 4 CORNER SYSTEM TO CREATE FULL FRAME -->
                <svg class="vine-frame vine-tl" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path class="stem-path" d="M0 25 C 20 20 60 30 100 25" stroke="#3e2723" stroke-width="3" stroke-linecap="round" fill="none"/>
                    <path class="stem-path" d="M25 0 C 30 20 20 60 25 100" stroke="#3e2723" stroke-width="3" stroke-linecap="round" fill="none"/>
                    <path class="leaf d-1" d="M10 25 Q -5 15 5 5 Z" fill="#6b8c42"/>
                    <path class="leaf d-2" d="M40 25 Q 50 10 30 5 Z" fill="#2d4a22"/>
                    <path class="leaf d-3" d="M70 25 Q 80 40 60 45 Z" fill="#556b2f"/>
                    <path class="leaf d-4" d="M25 40 Q 40 50 45 30 Z" fill="#9acd32"/>
                    <path class="leaf d-5" d="M25 80 Q 10 90 5 70 Z" fill="#6b8c42"/>
                    <g class="flower d-6" transform="translate(15, 15) scale(0.6)"><circle cx="0" cy="0" r="5" fill="#ffd700"/><path d="M0 0 Q 10 10 20 0" fill="#e056fd"/></g>
                </svg>
                <svg class="vine-frame vine-tr" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path class="stem-path" d="M0 25 C 40 30 80 20 100 25" stroke="#3e2723" stroke-width="3" stroke-linecap="round" fill="none"/>
                    <path class="stem-path" d="M75 0 C 80 20 70 60 75 100" stroke="#3e2723" stroke-width="3" stroke-linecap="round" fill="none"/>
                    <path class="leaf d-1" d="M10 25 Q 0 10 20 5 Z" fill="#556b2f"/>
                    <path class="leaf d-2" d="M50 25 Q 60 40 40 45 Z" fill="#6b8c42"/>
                    <path class="leaf d-3" d="M90 25 Q 100 10 80 5 Z" fill="#2d4a22"/>
                    <path class="leaf d-4" d="M75 50 Q 90 60 95 40 Z" fill="#9acd32"/>
                    <g class="flower d-5" transform="translate(85, 15) scale(0.6)"><circle cx="0" cy="0" r="5" fill="#ffd700"/><path d="M0 0 Q 10 10 20 0" fill="#d461a6"/></g>
                </svg>
                <svg class="vine-frame vine-bl" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path class="stem-path" d="M0 75 C 30 70 70 80 100 75" stroke="#3e2723" stroke-width="3" stroke-linecap="round" fill="none"/>
                    <path class="stem-path" d="M25 0 C 20 30 30 70 25 100" stroke="#3e2723" stroke-width="3" stroke-linecap="round" fill="none"/>
                    <path class="leaf d-1" d="M20 75 Q 10 90 30 95 Z" fill="#2d4a22"/>
                    <path class="leaf d-2" d="M60 75 Q 70 60 50 55 Z" fill="#6b8c42"/>
                    <path class="leaf d-3" d="M25 20 Q 10 10 5 30 Z" fill="#556b2f"/>
                    <path class="leaf d-4" d="M25 60 Q 40 50 45 70 Z" fill="#9acd32"/>
                    <g class="flower d-5" transform="translate(25, 85) scale(0.6)"><circle cx="0" cy="0" r="5" fill="#ffd700"/><path d="M0 0 Q 10 10 20 0" fill="#e056fd"/></g>
                </svg>
                <svg class="vine-frame vine-br" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path class="stem-path" d="M0 75 C 40 80 80 70 100 75" stroke="#3e2723" stroke-width="3" stroke-linecap="round" fill="none"/>
                    <path class="stem-path" d="M75 0 C 70 40 80 80 75 100" stroke="#3e2723" stroke-width="3" stroke-linecap="round" fill="none"/>
                    <path class="leaf d-1" d="M40 75 Q 50 90 30 95 Z" fill="#556b2f"/>
                    <path class="leaf d-2" d="M80 75 Q 90 60 70 55 Z" fill="#2d4a22"/>
                    <path class="leaf d-3" d="M75 30 Q 90 20 95 40 Z" fill="#6b8c42"/>
                    <g class="flower d-4" transform="translate(85, 85) scale(0.6)"><circle cx="0" cy="0" r="5" fill="#ffd700"/><path d="M0 0 Q 10 10 20 0" fill="#d461a6"/></g>
                </svg>

                <div class="speaker-name">
                    <img src="images/arcane_initial_logo.jpg" class="game-icon-seal" alt="Seal">
                    Master Merchant
                </div>
                <div id="dialogue" class="dialogue-text"></div>
            </div>
        </div>

        <a href="https://findiestudios.com" target="_blank" class="findie-logo-fixed"><span>¬© 2026 Findie</span><img src="images/findie_logo.webp" class="studio-logo" alt="Findie Studios Logo"></a>
        <div class="copyright-footer">¬© 2026 Findie Studios. All Rights Reserved.</div>
    </div>

    <!-- Modals (Common Room, About, etc) kept same as before ... -->
    <div id="lang-modal" class="modal"><div class="parchment"><span class="close-modal" onclick="closeModals()">&times;</span><h2>Select Region</h2><div class="lang-grid" id="lang-grid"></div></div></div>
    <div id="wares-modal" class="modal" style="background: rgba(0,0,0,0.4);"><div class="parchment" style="max-width: 500px; padding: 0; background: transparent; box-shadow: none; border: none;"><span class="close-modal" onclick="closeModals()" style="z-index: 50; color: #fff; text-shadow: 0 0 10px #000; top: 20px; left: 20px;">&times;</span><div class="story-container"><div class="story-progress" id="story-progress"></div><div class="story-header"><img src="images/arcane_initial_logo.jpg" class="story-avatar"><div class="story-info"><span class="story-username">Arcane Merchant</span><span class="story-time" id="txt-story-subtitle">New Arrival</span></div></div><div class="story-content"><div class="story-bg" id="story-bg"></div><img id="story-image" src="" class="story-img-main"><video id="story-video" class="story-img-main" playsinline muted loop style="display: none;"></video></div><div class="tap-zone left" onclick="moveCarousel(-1)"></div><div class="tap-zone right" onclick="moveCarousel(1)"></div></div></div></div>
    <div id="rumors-modal" class="modal"><div class="parchment" style="max-width: 600px;"><span class="close-modal" onclick="closeModals()">&times;</span><h2 style="font-size: 1.8rem; margin-bottom: 25px;">Whispers from the Void</h2><div style="margin-top: 20px; text-align: left;"><div style="margin-bottom: 25px; border-bottom: 1px dashed rgba(139, 69, 19, 0.2); padding-bottom: 15px;"><p id="txt-specs-title" style="font-weight: bold; color: #5d2e0a; margin-bottom: 15px;">‚ö° Scroll of Summoning</p><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 0.9rem;"><div><p id="txt-specs-min" style="font-weight: bold; color: #8b4513; margin-bottom: 5px;">Minimum Invocation</p><ul style="list-style: none; padding: 0; opacity: 0.8; font-size: 0.8rem; line-height: 1.4;"><li><strong>OS:</strong> Windows 10 (64-bit)</li><li><strong>CPU:</strong> i5-4460 / Ryzen 3 1200</li><li><strong>RAM:</strong> 8 GB</li><li><strong>GPU:</strong> GTX 960M / 750 Ti</li><li><strong>Space:</strong> 2 GB available</li></ul></div><div><p id="txt-specs-rec" style="font-weight: bold; color: #8b4513; margin-bottom: 5px;">Recommended Ritual</p><ul style="list-style: none; padding: 0; opacity: 0.8; font-size: 0.8rem; line-height: 1.4;"><li><strong>OS:</strong> Windows 10 / 11</li><li><strong>CPU:</strong> i5-9400 / Ryzen 5 3600</li><li><strong>RAM:</strong> 16 GB</li><li><strong>GPU:</strong> GTX 1660 / RTX 2060</li><li><strong>Space:</strong> 2 GB available</li></ul></div></div></div><div style="margin-bottom: 25px; border-bottom: 1px dashed rgba(139, 69, 19, 0.2); padding-bottom: 15px;"><p id="rumor-1-title" style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;"></p><p id="rumor-1-desc" style="font-style: italic; opacity: 0.8;"></p></div><div style="margin-bottom: 25px; border-bottom: 1px dashed rgba(139, 69, 19, 0.2); padding-bottom: 15px;"><p id="rumor-2-title" style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;"></p><p id="rumor-2-desc" style="font-style: italic; opacity: 0.8;"></p></div><div style="margin-bottom: 25px; border-bottom: 1px dashed rgba(139, 69, 19, 0.2); padding-bottom: 15px;"><p id="rumor-3-title" style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;"></p><p id="rumor-3-desc" style="font-style: italic; opacity: 0.8;"></p></div><div><p id="rumor-4-title" style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;"></p><p id="rumor-4-desc" style="font-style: italic; opacity: 0.8;"></p></div></div></div></div>
    <div id="community-modal" class="modal"><div class="parchment"><span class="close-modal" onclick="closeModals()">&times;</span><h2>The Common Room</h2><div class="community-links"><a href="https://www.findiestudios.com/" target="_blank" class="community-item"><span class="community-icon">üè∞</span> Findie</a><a href="https://discord.gg/findiestudios" target="_blank" class="community-item"><span class="community-icon">‚öîÔ∏è</span> Discord</a><a href="https://x.com/FindieStudios" target="_blank" class="community-item"><span class="community-icon">üìú</span> Twitter</a><a href="https://www.youtube.com/@FindieStudios" target="_blank" class="community-item"><span class="community-icon">üõ°Ô∏è</span> YouTube</a><a href="https://www.instagram.com/findiestudios" target="_blank" class="community-item"><span class="community-icon">üè∫</span> Instagram</a><a href="https://www.tiktok.com/@findiestudios" target="_blank" class="community-item"><span class="community-icon">üé≠</span> TikTok</a><a href="https://www.reddit.com/r/arcanemerchant" target="_blank" class="community-item"><span class="community-icon">‚öíÔ∏è</span> Reddit</a><a href="https://www.linkedin.com/company/findiestudios" target="_blank" class="community-item"><span class="community-icon">üóùÔ∏è</span> LinkedIn</a></div></div></div>
    <div id="about-modal" class="modal"><div class="parchment" style="max-width: 850px; width: 95vw;"><span class="close-modal" onclick="closeModals()">&times;</span><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid rgba(139, 69, 19, 0.3); padding-bottom: 15px;"><h2 style="margin: 0; border: none;">The Merchant's Guide</h2></div><div id="about-content" style="margin-top: 20px; line-height: 1.6; font-size: 1.1rem;"><p id="about-intro" style="margin-bottom: 25px; font-style: italic;"></p><div id="about-features" style="display: grid; grid-template-columns: 1fr; gap: 20px;"></div></div></div></div>
    <div id="video-modal" class="modal"><div class="parchment" style="max-width: 900px; background: #0a0a0a; border: 2px solid var(--gold); padding: 10px;"><span class="close-modal" onclick="closeVideoModal()">&times;</span><div class="video-container"><video id="video-player" controls muted playsinline></video></div></div></div>

    <script src="translations.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const dialogueElement = document.getElementById('dialogue');
        let merchantDialogues = []; 
        let currentLang = 'en'; 
        
        const menuKeys = [
            { key: 'menu_watch', action: 'handleWatch()' },
            { key: 'menu_wares', action: 'handleWares()' },
            { key: 'menu_rumors', action: 'handleRumors()' },
            { key: 'menu_common', action: 'handleCommunity()' },
            { key: 'menu_about', action: 'handleAbout()' },
            { key: 'menu_steam', link: 'https://store.steampowered.com/app/4086760/Arcane_Merchant/' }
        ];

        let currentDialogueIndex = 0;
        let typeTimeout;
        let autoTalkInterval;
        let isTyping = false;
        let hls;

        function getQuotes() {
            if (!translations[currentLang] || !translations[currentLang].merchant) return translations['en'].merchant.quotes;
            return translations[currentLang].merchant.quotes;
        }

        window.handleWatch = function() { resetAutoTalk(); showVideoModal(); typeWriter(getQuotes()[0], dialogueElement, 30); }
        window.handleWares = function() { resetAutoTalk(); showModal('wares-modal'); initCarousel(); typeWriter(getQuotes()[1], dialogueElement, 30); }
        window.handleRumors = function() { resetAutoTalk(); showModal('rumors-modal'); typeWriter(getQuotes()[4], dialogueElement, 30); }
        window.handleCommunity = function() { resetAutoTalk(); showModal('community-modal'); typeWriter(getQuotes()[8], dialogueElement, 30); }
        window.handleAbout = function() { resetAutoTalk(); showModal('about-modal'); typeWriter(getQuotes()[2], dialogueElement, 30); }

        function startAutoTalk() {
            if (autoTalkInterval) clearInterval(autoTalkInterval);
            autoTalkInterval = setInterval(() => {
                if (isTyping) return;
                const quotes = getQuotes();
                let nextIndex = Math.floor(Math.random() * quotes.length);
                if (nextIndex === currentDialogueIndex && quotes.length > 1) nextIndex = (nextIndex + 1) % quotes.length;
                currentDialogueIndex = nextIndex;
                typeWriter(quotes[currentDialogueIndex], dialogueElement, 40);
            }, 12000);
        }

        function resetAutoTalk() { startAutoTalk(); }

        function closeModals() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('visible'));
            stopC();
        }

        function showModal(modalId) {
            closeModals();
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.add('visible');
        }

        function showVideoModal() {
            const modal = document.getElementById('video-modal'), video = document.getElementById('video-player');
            const src = 'https://video.fastly.steamstatic.com/store_trailers/4086760/1025836541/d1d348ada576efe61787479707370305904dfecb/1769431428/hls_264_master.m3u8';
            modal.classList.add('visible');
            if (Hls.isSupported()) {
                if (hls) hls.destroy();
                hls = new Hls(); hls.loadSource(src); hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            }
        }

        function closeVideoModal() { document.getElementById('video-player').pause(); closeModals(); }

        function typeWriter(text, element, speed = 35, callback) {
            if (isTyping) clearTimeout(typeTimeout);
            isTyping = true; element.innerHTML = ""; let i = 0;
            if (!text) text = "...";
            function type() {
                if (i < text.length) { element.innerHTML += text.charAt(i); i++; typeTimeout = setTimeout(type, speed); }
                else { isTyping = false; if (callback) callback(); }
            }
            type();
        }

        let carouselImages = [];
        for (let i = 1; i <= 16; i++) carouselImages.push({ type: 'image', src: `images/inventory/inventory_${i}.jpg?v=force_refresh_${Date.now()}` });
        carouselImages.splice(2, 0, { type: 'video', src: 'images/inventory/story_clip_1.mp4' });
        carouselImages.splice(5, 0, { type: 'video', src: 'images/inventory/story_clip_2.mp4' });
        carouselImages.splice(8, 0, { type: 'video', src: 'images/inventory/story_clip_3.mp4' });
        carouselImages.splice(11, 0, { type: 'video', src: 'images/inventory/story_clip_4.mp4' });
        carouselImages.splice(14, 0, { type: 'video', src: 'images/inventory/story_clip_5.mp4' });
        carouselImages.splice(17, 0, { type: 'video', src: 'images/inventory/story_clip_6.mp4' });
        
        let currentCarouselIndex = 0, carouselInterval;

        function initCarousel() {
            const progressContainer = document.getElementById('story-progress');
            progressContainer.innerHTML = '';
            carouselImages.forEach((_, index) => {
                const bar = document.createElement('div'); bar.className = 'story-bar';
                const fill = document.createElement('div'); fill.className = 'story-bar-fill';
                bar.appendChild(fill); progressContainer.appendChild(bar);
            });
            startC();
        }

        function startC() { stopC(); showCarouselImage(currentCarouselIndex); }
        function stopC() { 
            if (carouselInterval) clearTimeout(carouselInterval);
            const video = document.getElementById('story-video');
            if (video) { video.onended = null; video.ontimeupdate = null; video.pause(); }
        }

        function showCarouselImage(index) {
            if (index >= carouselImages.length) currentCarouselIndex = 0;
            else if (index < 0) currentCarouselIndex = carouselImages.length - 1;
            else currentCarouselIndex = index;

            const item = carouselImages[currentCarouselIndex];
            const mainImg = document.getElementById('story-image');
            const mainVideo = document.getElementById('story-video');
            const bgDiv = document.getElementById('story-bg');
            
            const bars = document.querySelectorAll('.story-bar-fill');
            bars.forEach(b => { b.style.width = '0%'; b.style.transition = 'none'; });
            for(let i=0; i<currentCarouselIndex; i++) bars[i].style.width = '100%';
            const currentBar = bars[currentCarouselIndex];
            
            if (item.type === 'video') {
                mainImg.style.display = 'none'; mainVideo.style.display = 'block';
                mainVideo.src = item.src; mainVideo.currentTime = 0;
                bgDiv.style.backgroundImage = 'none'; bgDiv.style.backgroundColor = 'transparent';
                currentBar.style.transition = 'none';
                mainVideo.ontimeupdate = () => { if (mainVideo.duration) currentBar.style.width = `${(mainVideo.currentTime / mainVideo.duration) * 100}%`; };
                mainVideo.play().then(() => { mainVideo.onended = () => moveCarousel(1); })
                .catch(e => { carouselInterval = setTimeout(() => moveCarousel(1), 4000); });
            } else {
                if (mainVideo) { mainVideo.pause(); mainVideo.style.display = 'none'; }
                mainImg.style.display = 'block'; mainImg.src = item.src;
                if (bgDiv) bgDiv.style.backgroundImage = `url('${item.src}')`;
                setTimeout(() => { currentBar.style.transition = 'width 4s linear'; currentBar.style.width = '100%'; }, 10);
                carouselInterval = setTimeout(() => moveCarousel(1), 4000);
            }
        }
        function moveCarousel(step) { stopC(); showCarouselImage(currentCarouselIndex + step); }

        function initLanguage() {
            try {
                const grid = document.getElementById('lang-grid');
                if (grid) {
                    grid.innerHTML = '';
                    if (typeof translations === 'undefined') throw new Error("Translations missing");
                    Object.keys(translations).forEach(code => {
                        const btn = document.createElement('div'); btn.className = 'lang-btn';
                        btn.innerText = translations[code].name; btn.onclick = () => setLanguage(code);
                        if (code === currentLang) btn.classList.add('active'); grid.appendChild(btn);
                    });
                }
                const saved = localStorage.getItem('arcane_lang');
                if (saved && translations[saved]) setLanguage(saved); else setLanguage('en');
            } catch(e) { console.error("Lang Init Failed", e); setLanguage('en'); }
        }

        function setLanguage(code) {
            if (!translations || !translations[code]) code = 'en';
            currentLang = code; localStorage.setItem('arcane_lang', code);
            const data = translations[code]; const en = translations['en'];
            document.querySelectorAll('.lang-btn').forEach(b => { b.classList.remove('active'); if (b.innerText === data.name) b.classList.add('active'); });
            if (document.getElementById('lang-modal').classList.contains('visible')) closeModals();
            const menuContainer = document.querySelector('.menu-container');
            if (menuContainer) {
                menuContainer.innerHTML = '';
                menuKeys.forEach(item => {
                    let el; let text = "Menu Item";
                    try { text = (data.ui && data.ui[item.key]) ? data.ui[item.key] : (en.ui && en.ui[item.key] ? en.ui[item.key] : item.key); } catch(e) { text = item.key; }
                    if (item.link) {
                        el = document.createElement('a'); el.href = item.link; el.target = "_blank"; el.className = 'menu-btn';
                        el.style = "color: #fff; background: linear-gradient(135deg, #1b2838 0%, #2a475e 100%); border-color: #66c0f4; display: flex; align-items: center; justify-content: center; gap: 10px;";
                        el.innerHTML = `<img src="images/steam_logo_official.jpg" width="20" height="20" style="border-radius: 50%;"> ${text}`;
                    } else {
                        el = document.createElement('button'); el.className = 'menu-btn';
                        if (item.key === 'menu_watch') el.setAttribute('onclick', 'window.handleWatch()');
                        else if (item.key === 'menu_wares') el.setAttribute('onclick', 'window.handleWares()');
                        else if (item.key === 'menu_rumors') el.setAttribute('onclick', 'window.handleRumors()');
                        else if (item.key === 'menu_common') el.setAttribute('onclick', 'window.handleCommunity()');
                        else if (item.key === 'menu_about') el.setAttribute('onclick', 'window.handleAbout()');
                        el.innerText = text;
                    }
                    menuContainer.appendChild(el);
                });
            }
            const safeText = (selector, key) => { const el = document.querySelector(selector); if (el) try { el.innerText = (data.ui && data.ui[key]) ? data.ui[key] : (en.ui ? en.ui[key] : ""); } catch(e) {} };
            safeText('#wares-modal .story-username', 'merchant_name');
            safeText('#rumors-modal h2', 'modal_rumors_title');
            safeText('#community-modal h2', 'modal_common_title');
            safeText('#about-modal h2', 'modal_about_title');
            safeText('.copyright-footer', 'footer_rights');
            const specsTitle = (data.ui && data.ui['specs_title']) ? data.ui['specs_title'] : (en.ui ? en.ui['specs_title'] : "Scroll of Summoning");
            const elSpecs = document.getElementById('txt-specs-title'); if(elSpecs) elSpecs.innerText = "‚ö° " + specsTitle;
            safeText('#txt-specs-min', 'specs_min'); safeText('#txt-specs-rec', 'specs_rec');
            if (data.rumors && Array.isArray(data.rumors)) {
                for(let i=0; i<4; i++) {
                    if (data.rumors[i]) {
                        const rTitle = document.getElementById(`rumor-${i+1}-title`); const rDesc = document.getElementById(`rumor-${i+1}-desc`);
                        if (rTitle) rTitle.innerText = data.rumors[i].title; if (rDesc) rDesc.innerText = data.rumors[i].desc;
                    }
                }
            } else if (en.rumors) {
                for(let i=0; i<4; i++) {
                    const rTitle = document.getElementById(`rumor-${i+1}-title`); const rDesc = document.getElementById(`rumor-${i+1}-desc`);
                    if (rTitle) rTitle.innerText = en.rumors[i].title; if (rDesc) rDesc.innerText = en.rumors[i].desc;
                }
            }
            const subtitleMap = { 'tr': 'Yeni Gelen', 'de': 'Neuank√∂mmling', 'fr-FR': 'Nouvel Arrivant', 'es-ES': 'Reci√©n Llegado', 'ru-RU': '–ù–æ–≤–æ–µ –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ', 'zh': 'Êñ∞Âà∞Ë¥ß', 'zh-TW': 'Êñ∞Âà∞Ë≤®', 'ja-JP': 'Êñ∞ÂÖ•Ëç∑', 'ko': 'Ïã†ÏÉÅÌíà', 'pt-BR': 'Rec√©m Chegado', 'it': 'Nuovo Arrivo', 'pl-PL': 'Nowa Dostawa' };
            const subText = subtitleMap[code] || "New Arrival";
            const elSub = document.getElementById('txt-story-subtitle'); if(elSub) elSub.innerText = subText;
            const mName = (data.ui && data.ui['merchant_name']) ? data.ui['merchant_name'] : (en.ui ? en.ui['merchant_name'] : "Merchant");
            const seal = document.querySelector('.speaker-name'); if (seal) seal.innerHTML = `<img src="images/arcane_initial_logo.jpg" class="game-icon-seal" alt="Seal"> ${mName}`;
            if (data.merchant && data.merchant.quotes) merchantDialogues = data.merchant.quotes; else if (en.merchant && en.merchant.quotes) merchantDialogues = en.merchant.quotes;
            const welcome = (data.merchant && data.merchant.welcome) ? data.merchant.welcome : (en.merchant ? en.merchant.welcome : "Welcome.");
            if (!isTyping) typeWriter(welcome, dialogueElement, 40);
            resetAutoTalk();
            if (typeof updateAboutText === 'function') updateAboutText(code);
            const toast = document.createElement('div'); toast.innerText = `Region Set: ${data.name}`;
            toast.style.position = 'fixed'; toast.style.top = '20px'; toast.style.left = '50%'; toast.style.transform = 'translateX(-50%)'; toast.style.background = 'rgba(0,0,0,0.8)'; toast.style.color = '#d4af37'; toast.style.padding = '10px 20px'; toast.style.borderRadius = '4px'; toast.style.border = '1px solid #d4af37'; toast.style.zIndex = '3000'; toast.style.fontFamily = 'var(--ui-font)';
            document.body.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 500); }, 2000);
        }

        function updateAboutText(langCode) {
            const data = translations[langCode]; if (!data) return;
            document.getElementById('about-intro').innerText = data.intro;
            const featuresContainer = document.getElementById('about-features'); featuresContainer.innerHTML = '';
            data.features.forEach(feature => {
                const p = document.createElement('p'); const parts = feature.split('\n'); const headline = parts[0]; const body = parts[1] || "";
                p.innerHTML = `<strong>${headline}</strong><br><span style="opacity: 0.9; font-size: 0.95em;">${body}</span>`;
                p.style.marginBottom = '20px'; p.style.paddingLeft = '15px'; p.style.borderLeft = '3px solid #d4af37'; featuresContainer.appendChild(p);
            });
            let endingEl = document.getElementById('about-ending');
            if (!endingEl) { endingEl = document.createElement('p'); endingEl.id = 'about-ending'; endingEl.style.marginTop = '30px'; endingEl.style.fontWeight = 'bold'; endingEl.style.color = '#d4af37'; endingEl.style.textAlign = 'center'; document.getElementById('about-content').appendChild(endingEl); }
            endingEl.innerText = data.ending || "";
        }

        // --- MAJESTIC BUTTERFLY LOGIC ---
        function spawnButterfly() {
            const dialogueBox = document.querySelector('.dialogue-box'); if (!dialogueBox) return;
            // Limit population
            if (document.querySelectorAll('.butterfly').length >= 4) return;

            const b = document.createElement('div'); 
            const colorClass = ['bt-gold', 'bt-blue', 'bt-purple'][Math.floor(Math.random() * 3)];
            b.className = `butterfly ${colorClass}`; 
            b.innerHTML = '<div class="butterfly-body"></div><div class="wing left"></div><div class="wing right"></div>';

            // Random Corner Target (TL, TR, BL, BR) for landing
            const corners = [
                { id: 'tl', x: 20, y: 20 },
                { id: 'tr', x: dialogueBox.offsetWidth - 40, y: 20 },
                { id: 'bl', x: 20, y: dialogueBox.offsetHeight - 40 },
                { id: 'br', x: dialogueBox.offsetWidth - 40, y: dialogueBox.offsetHeight - 40 }
            ];
            const targetCorner = corners[Math.floor(Math.random() * corners.length)];

            // Spawn off-screen or far away
            const startX = Math.random() * window.innerWidth;
            const startY = Math.random() * window.innerHeight;
            b.style.left = startX + 'px';
            b.style.top = startY + 'px';
            
            document.body.appendChild(b); // Append to body to fly freely

            // 1. Fly to Target
            // Calculate relative position to dialogue box
            const boxRect = dialogueBox.getBoundingClientRect();
            const destX = boxRect.left + targetCorner.x + (Math.random() * 40 - 20);
            const destY = boxRect.top + targetCorner.y + (Math.random() * 40 - 20);

            // Trigger Fly
            requestAnimationFrame(() => {
                b.style.left = destX + 'px';
                b.style.top = destY + 'px';
                // Calculate rotation angle
                const angle = Math.atan2(destY - startY, destX - startX) * 180 / Math.PI;
                b.style.transform = `rotate(${angle + 90}deg) scale(0.8)`;
            });

            // 2. Land
            setTimeout(() => {
                b.classList.add('landed');
                // Adjust rotation to "sit"
                b.style.transform = `rotate(${Math.random() * 360}deg) scale(0.8)`;
                
                // 3. Wait & Take off
                setTimeout(() => {
                    b.classList.remove('landed');
                    const exitX = destX + (Math.random() - 0.5) * 500;
                    const exitY = destY - 500;
                    b.style.left = exitX + 'px';
                    b.style.top = exitY + 'px';
                    b.style.opacity = '0';
                    
                    setTimeout(() => b.remove(), 4000);
                }, 5000 + Math.random() * 5000); // Sit for 5-10s

            }, 4000); // Flight duration
        }

        function spawnPetal() {
            const p = document.createElement('div'); const colors = ['pink', 'red', 'maroon']; p.classList.add('petal', colors[Math.floor(Math.random() * colors.length)]);
            const startLeft = Math.random() * 100; const duration = 6 + Math.random() * 6; const size = 10 + Math.random() * 15;
            p.style.left = startLeft + 'vw'; p.style.width = size + 'px'; p.style.height = size + 'px'; p.style.animationDuration = duration + 's';
            document.body.appendChild(p); setTimeout(() => { p.remove(); }, duration * 1000);
        }

        window.onload = () => {
            initLanguage(); 
            const ui = document.getElementById('game-ui'); if (ui) ui.classList.add('ready');
            startAutoTalk();
            setInterval(spawnButterfly, 6000); // Slower spawn rate
            setInterval(spawnPetal, 800); 
            setInterval(() => {
                const ember = document.createElement('div'); ember.className = 'ember'; ember.style.left = Math.random() * 100 + 'vw'; ember.style.animationDuration = (Math.random() * 5 + 5) + 's'; ember.style.opacity = Math.random(); document.body.appendChild(ember); setTimeout(() => ember.remove(), 10000);
            }, 300);
        };
        const closeAll = e => { if (e.target.classList.contains('modal')) closeVideoModal(); };
        window.onclick = closeAll; window.ontouchstart = closeAll;
    </script>
</body>
</html>