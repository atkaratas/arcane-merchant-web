<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Arcane Merchant | Shop Management Sim</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --dark-bg: rgba(15, 15, 20, 0.98);
            --parchment: #f4e4bc;
            --ui-font: 'Cinzel', serif;
            --dialogue-font: 'Crimson Text', serif;
            --transition-speed: 0.8s;
            --magical-glow: 0 0 20px rgba(212, 175, 55, 0.4);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: #050505;
            color: #fff;
            position: fixed;
        }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050505 url('images/official-background.jpg?v=final_fix') no-repeat center center !important;
            background-size: cover !important;
            z-index: -1;
            filter: brightness(0.8) sepia(0.1);
            animation: slowZoom 60s linear infinite alternate;
        }

        @keyframes slowZoom { from { transform: scale(1); } to { transform: scale(1.15); } }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.6) 100%);
            pointer-events: none;
            z-index: 0;
        }

        /* --- COZY ATMOSPHERE --- */
        .warm-overlay {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60%;
            background: radial-gradient(ellipse at bottom, rgba(255, 160, 60, 0.15) 0%, rgba(100, 50, 0, 0.05) 40%, transparent 80%);
            z-index: 0;
            pointer-events: none;
            mix-blend-mode: screen;
        }

        .ember {
            position: fixed;
            bottom: -10px;
            width: 4px;
            height: 4px;
            background: #ffcc00;
            border-radius: 50%;
            box-shadow: 0 0 10px #ff6600, 0 0 20px #ffcc00;
            opacity: 0;
            z-index: 1;
            pointer-events: none;
            animation: floatUp linear infinite;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) translateX(0) scale(0.5); opacity: 0; }
            10% { opacity: 0.8; }
            50% { opacity: 0.6; }
            100% { transform: translateY(-80vh) translateX(20px) scale(0); opacity: 0; }
        }

        .game-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            padding: 40px;
            opacity: 0;
            transition: opacity 1.5s ease-in;
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .game-container.ready {
            opacity: 1;
            display: flex !important;
        }

        .branding-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: var(--ui-font);
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
            z-index: 20;
            margin-bottom: 25px;
        }

        .official-logo {
            max-width: 450px;
            width: 95%;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 0 20px rgba(212, 175, 55, 0.6)) drop-shadow(0 0 40px rgba(212, 175, 55, 0.2));
            margin-bottom: 5px;
            display: block;
        }

        .branding-container p {
            font-family: var(--ui-font);
            font-style: italic;
            font-size: 0.9rem;
            color: #ccc;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-align: center;
            margin-top: 10px;
        }

        .menu-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 10;
            width: 350px !important;
            margin-left: auto !important;
            margin-right: auto !important;
            margin-bottom: 40px;
            justify-content: center;
        }

        .menu-btn {
            background: rgba(10, 10, 15, 0.4);
            backdrop-filter: blur(5px);
            /* MEDIEVAL FRAME STYLE */
            border: 3px double rgba(212, 175, 55, 0.6); /* Double gold border */
            border-radius: 4px;
            color: var(--gold);
            padding: 14px 30px;
            font-family: var(--ui-font);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.4s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            /* Inner shadow for depth + Outer shadow for lift */
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5), 0 4px 15px rgba(0,0,0,0.3);
            text-align: center;
            text-decoration: none;
            display: block;
            width: 100%;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        .menu-btn:hover {
            border-color: var(--gold);
            background: rgba(212, 175, 55, 0.15);
            transform: scale(1.02); /* Subtle scale */
            box-shadow: inset 0 0 20px rgba(212, 175, 55, 0.2), 0 0 20px rgba(212, 175, 55, 0.4);
        }

        .dialogue-wrapper {
            width: 100%;
            max-width: 900px;
            position: relative;
            transform: translateY(0);
            transition: transform 0.5s ease;
            text-align: left;
        }

        .dialogue-box {
            background: var(--dark-bg);
            border: 2px solid rgba(212, 175, 55, 0.5);
            padding: 30px 40px;
            min-height: 150px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
            border-radius: 2px;
        }

        .findie-logo-fixed {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0.8;
            transition: all 0.4s ease;
            text-decoration: none;
            color: var(--gold);
            font-family: var(--ui-font);
            font-size: 0.5rem; /* Much smaller text */
            padding: 5px 10px; /* Reduced padding */
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .findie-logo-fixed:hover {
            opacity: 1;
            filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.4));
            transform: translateY(-1px);
            border-color: rgba(212, 175, 55, 0.8);
        }

        .studio-logo {
            height: 18px; /* Slightly smaller but clear */
            width: auto;
            filter: drop-shadow(0 0 5px rgba(212, 175, 55, 0.2));
        }
        
        .copyright-footer {
            position: fixed;
            bottom: 5px;
            width: 100%;
            text-align: center;
            font-family: var(--ui-font);
            font-size: 0.5rem;
            color: rgba(255, 255, 255, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
            z-index: 500;
            pointer-events: none;
        }

        .speaker-name {
            position: absolute;
            top: -14px;
            left: 30px;
            background: var(--gold);
            color: #000;
            padding: 3px 18px;
            font-family: var(--ui-font);
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }

        .game-icon-seal {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        .dialogue-text {
            font-family: var(--dialogue-font);
            font-size: 1.6rem;
            line-height: 1.5;
            color: #f0f0f0;
            min-height: 1.5em;
        }

        .dialogue-text::after {
            content: "|";
            animation: blink 1s step-end infinite;
            margin-left: 5px;
            color: var(--gold);
        }

        @keyframes blink { from, to { opacity: 1; } 50% { opacity: 0; } }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 2000; /* Increased to sit above dialogue box (z-1000) */
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .modal.visible {
            display: flex;
            opacity: 1;
        }

        .parchment {
            background: var(--parchment);
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            color: #2c1e0f;
            width: 95%;
            max-width: 750px;
            padding: 40px;
            border-radius: 3px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.7), inset 0 0 60px rgba(139, 69, 19, 0.2);
            position: relative;
            font-family: var(--dialogue-font);
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            -webkit-overflow-scrolling: touch;
        }

        .modal.visible .parchment {
            transform: scale(1);
        }

        .parchment h2 {
            font-family: var(--ui-font);
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(139, 69, 19, 0.3);
            padding-bottom: 15px;
            color: #5d2e0a;
            text-align: center;
            letter-spacing: 2px;
        }

        .carousel-container {
            position: relative;
            width: 100%;
            height: 450px;
            margin: 20px 0;
            overflow: hidden;
            /* COZY DISPLAY CASE STYLE */
            border: 4px solid #5d2e0a;
            outline: 2px solid #d4af37;
            outline-offset: -6px;
            border-radius: 8px;
            background: radial-gradient(circle, #2a1a10 0%, #1a0f08 100%);
            /* Removed flex to prevent layout issues with absolute children */
            display: block; 
            box-shadow: inset 0 0 40px rgba(0,0,0,0.8), 0 10px 30px rgba(0,0,0,0.5);
        }

        .carousel-image {
            position: absolute;
            width: 85%;
            height: 85%;
            object-fit: contain;
            margin: auto;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            opacity: 0;
            transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
            will-change: opacity, transform;
            z-index: 5; /* Increased */
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.6)); 
        }

        .carousel-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.2); /* Slight background to ensure clickability */
            border-radius: 50%;
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: rgba(212, 175, 55, 0.8);
            font-size: 2rem;
            cursor: pointer;
            z-index: 20; /* High Z-Index */
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            text-shadow: 0 2px 5px rgba(0,0,0,0.8);
        }

        .carousel-arrow:hover {
            opacity: 1;
            color: #d4af37;
            transform: translateY(-50%) scale(1.1);
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
        }

        .carousel-arrow.prev { left: 15px; }
        .carousel-arrow.next { right: 15px; }

        .community-links {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .community-item {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: #2c1e0f;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            padding: 10px;
            background: rgba(139, 69, 19, 0.05);
            border-radius: 4px;
        }

        .community-item:hover {
            background: rgba(139, 69, 19, 0.12);
            transform: translateY(-2px);
        }

        .community-icon {
            font-size: 1.4rem;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            left: 20px; /* Globally moved to Left */
            right: auto; /* Clear Right */
            font-size: 2.5rem;
            cursor: pointer;
            color: #8b4513;
            line-height: 1;
            transition: transform 0.3s ease;
            z-index: 10;
        }

        /* Video Modal Specific Close Button (Just color override now) */
        #video-modal .close-modal {
            color: var(--gold);
            text-shadow: 0 0 5px #000;
        }

        .close-modal:hover {
            transform: rotate(90deg);
        }

        /* --- STORY MODE STYLES --- */
        .story-container {
            position: relative;
            width: 100%;
            height: 80vh;
            max-height: 800px;
            background: transparent; /* Changed from #000 */
            display: flex;
            flex-direction: column;
        }

        .story-progress {
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            display: flex;
            gap: 4px;
            padding: 0 10px;
            z-index: 20;
        }

        .story-bar {
            flex: 1;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }

        .story-bar-fill {
            height: 100%;
            width: 0%;
            background: #fff;
            transition: width 0.2s linear;
        }
        
        .story-bar.active .story-bar-fill { width: 100%; }
        .story-bar.seen .story-bar-fill { width: 100%; }

        .story-header {
            position: absolute;
            top: 25px;
            left: 55px; /* Offset for Close Button on Left */
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 20;
        }

        .story-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--gold);
        }

        .story-info {
            display: flex;
            flex-direction: column;
        }

        .story-username {
            color: #fff;
            font-size: 0.9rem;
            font-weight: bold;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }

        .story-time {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.75rem;
        }

        .story-content {
            position: relative;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .story-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(20px) brightness(0.6);
            opacity: 0.6; /* Semi-transparent background image */
            transform: scale(1.1);
            z-index: 1;
        }

        .story-img-main {
            position: relative;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1/1;
            object-fit: contain;
            z-index: 2;
            /* EDGELESS STYLE */
            border: none; /* Removed border */
            box-shadow: 0 0 30px rgba(0,0,0,0.5); /* Soft glow instead of hard shadow */
            border-radius: 8px;
            background: transparent; /* No plating */
        }

        .tap-zone {
            position: absolute;
            top: 0;
            height: 100%;
            width: 35%;
            z-index: 10;
            cursor: pointer;
        }
        .tap-zone.left { left: 0; }
        .tap-zone.right { right: 0; }

        /* --- END STORY --- */

        .video-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
            background: #000;
            border: 4px solid var(--gold);
        }

        video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @media (max-width: 768px) {
            .game-container { 
                justify-content: flex-start; 
                padding-top: 20px; /* Moved up */
                padding-bottom: 180px; 
                overflow-y: auto; 
                height: 100vh;
                display: block !important; 
            }
            
            .branding-container {
                margin-top: 15px;
                margin-bottom: 20px;
            }

            .official-logo { 
                max-width: 240px; 
            }
            
            .branding-container p { 
                font-size: 0.65rem; 
                margin-top: 8px;
            }
            
            .menu-container { 
                width: 85% !important; 
                gap: 8px; /* Tighter gap */
                margin: 0 auto 30px auto; 
            }
            
            .menu-btn { 
                padding: 10px; /* Smaller button */
                font-size: 0.85rem; 
            }
            
            .dialogue-wrapper {
                position: fixed;
                bottom: 15px;
                left: 50%;
                transform: translateX(-50%);
                width: 94%;
                z-index: 1000;
                margin: 0;
            }

            .dialogue-box { 
                padding: 15px 20px; 
                min-height: 110px; /* Smaller box */
                background: rgba(5, 5, 8, 0.25);
                backdrop-filter: blur(12px);
                border: 1px solid rgba(212, 175, 55, 0.3);
                box-shadow: 0 -5px 30px rgba(0,0,0,0.3);
            }
            
            .dialogue-text { 
                font-size: 1.0rem; /* Slightly smaller text */
                line-height: 1.4;
                text-shadow: 0 1px 4px rgba(0,0,0,0.9), 0 0 10px rgba(0,0,0,0.8);
            }

            .speaker-name {
                top: -10px;
                left: 15px;
                font-size: 0.55rem; /* Smaller text */
                padding: 2px 10px; /* Much tighter padding */
                gap: 5px;
                letter-spacing: 0.5px;
            }
            
            .game-icon-seal {
                width: 16px; /* Smaller icon */
                height: 16px;
            }

            .parchment { 
                padding: 45px 15px 25px 15px; /* Added top padding for Close Button */
                width: 92vw;
                max-height: 80vh;
            }
            
            .carousel-container { 
                height: 300px; 
            }
            
            .community-links { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 10px; 
            }
            
            .community-item { 
                font-size: 0.85rem; 
                padding: 8px; 
            }
        }

        @media (max-height: 700px) {
            .game-container { justify-content: flex-start; padding-top: 20px; overflow-y: auto; }
            .official-logo { max-width: 200px; }
            .menu-container { gap: 8px; margin-bottom: 15px; }
            .menu-btn { padding: 8px 12px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>

    <div class="background"></div>
    <div class="overlay"></div>
    <div class="warm-overlay"></div>

    <div id="game-ui" class="game-container">
        
        <div class="branding-container">
            <img src="images/official_logo.png" alt="Arcane Merchant Logo" class="official-logo">
            <p>MEDIEVAL FANTASY SHOP SIMULATOR ‚Ä¢ APRIL 10 2026 RELEASE!</p>
        </div>

        <div class="menu-container">
            <button class="menu-btn" onclick="handleWatch()">Watch Chronicles</button>
            <button class="menu-btn" onclick="handleWares()">Browse Wares</button>
            <button class="menu-btn" onclick="handleRumors()">Ask Rumors</button>
            <button class="menu-btn" onclick="handleCommunity()">The Common Room</button>
            <button class="menu-btn" onclick="handleAbout()">About the Game</button>
            <a href="https://store.steampowered.com/app/4086760/Arcane_Merchant/" target="_blank" class="menu-btn" style="color: #fff; background: linear-gradient(135deg, #1b2838 0%, #2a475e 100%); border-color: #66c0f4; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <img src="images/steam_logo_official.jpg" width="20" height="20" style="border-radius: 50%;">
                Wishlist on Steam
            </a>
        </div>

        <div class="dialogue-wrapper">
            <div class="dialogue-box">
                <div class="speaker-name">
                    <img src="images/arcane_initial_logo.jpg" class="game-icon-seal" alt="Seal">
                    Master Merchant
                </div>
                <div id="dialogue" class="dialogue-text"></div>
            </div>
        </div>

        <a href="https://findiestudios.com" target="_blank" class="findie-logo-fixed">
            <span>¬© 2026 Findie</span>
            <img src="images/findie_logo.webp" class="studio-logo" alt="Findie Studios Logo">
        </a>
        
        <div class="copyright-footer">¬© 2026 Findie Studios. All Rights Reserved.</div>
    </div>

    <div id="wares-modal" class="modal" style="background: rgba(0,0,0,0.7);">
        <div class="parchment" style="max-width: 500px; padding: 0; background: rgba(20, 20, 30, 0.3); backdrop-filter: blur(15px); overflow: hidden; border: 2px solid rgba(212, 175, 55, 0.5); box-shadow: 0 20px 50px rgba(0,0,0,0.5);">
            <span class="close-modal" onclick="closeModals()" style="z-index: 50; color: #fff; text-shadow: 0 0 5px #000; top: 20px; left: 20px;">&times;</span>
            
            <div class="story-container">
                <!-- Progress Bars -->
                <div class="story-progress" id="story-progress">
                    <!-- Bars injected by JS -->
                </div>

                <!-- Header -->
                <div class="story-header">
                    <img src="images/arcane_initial_logo.jpg" class="story-avatar">
                    <div class="story-info">
                        <span class="story-username">Arcane Merchant</span>
                        <span class="story-time">New Arrival</span>
                    </div>
                </div>

                <!-- Content -->
                <div class="story-content">
                    <div class="story-bg" id="story-bg"></div>
                    <img id="story-image" src="" class="story-img-main">
                    <video id="story-video" class="story-img-main" playsinline muted loop style="display: none;"></video>
                </div>

                <!-- Tap Zones -->
                <div class="tap-zone left" onclick="moveCarousel(-1)"></div>
                <div class="tap-zone right" onclick="moveCarousel(1)"></div>
            </div>
            
            <div style="position: absolute; bottom: 30px; width: 100%; text-align: center; z-index: 20;">
                <p style="font-weight: bold; color: #fff; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 2px; text-shadow: 0 2px 4px rgba(0,0,0,0.8);">‚úß Magically Discovered ‚úß</p>
            </div>
        </div>
    </div>

    <div id="rumors-modal" class="modal">
        <div class="parchment" style="max-width: 600px;">
            <span class="close-modal" onclick="closeModals()">&times;</span>
            <h2 style="font-size: 1.8rem; margin-bottom: 25px;">Whispers from the Void</h2>
            <div style="margin-top: 20px; text-align: left;">
                
                <!-- MOVED TO TOP & SIMPLIFIED TITLE -->
                <div style="margin-bottom: 35px; border-bottom: 2px solid #5d2e0a; padding-bottom: 25px;">
                    <h3 style="font-family: var(--ui-font); color: #5d2e0a; margin-bottom: 15px; font-size: 1.2rem; text-align: center;">‚ö° Scroll of Summoning</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 0.9rem;">
                        <div>
                            <p style="font-weight: bold; color: #8b4513;">Minimum Invocation</p>
                            <ul style="list-style: none; padding: 0; opacity: 0.8; font-size: 0.8rem;">
                                <li><strong>OS:</strong> Windows 10 (64-bit)</li>
                                <li><strong>CPU:</strong> i5-4460 / Ryzen 3 1200</li>
                                <li><strong>RAM:</strong> 8 GB</li>
                                <li><strong>GPU:</strong> GTX 960M / 750 Ti / R7 265</li>
                                <li><strong>DX:</strong> Version 11</li>
                                <li><strong>Space:</strong> 2 GB available</li>
                            </ul>
                        </div>
                        <div>
                            <p style="font-weight: bold; color: #8b4513;">Recommended Ritual</p>
                            <ul style="list-style: none; padding: 0; opacity: 0.8; font-size: 0.8rem;">
                                <li><strong>OS:</strong> Windows 10 / 11 (64-bit)</li>
                                <li><strong>CPU:</strong> i5-9400 / Ryzen 5 3600</li>
                                <li><strong>RAM:</strong> 16 GB</li>
                                <li><strong>GPU:</strong> GTX 1660 / RTX 2060</li>
                                <li><strong>DX:</strong> Version 11</li>
                                <li><strong>Space:</strong> 2 GB available</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 25px; border-bottom: 1px dashed rgba(139, 69, 19, 0.2); padding-bottom: 15px;">
                    <p style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;">üìú The High King's Debt</p>
                    <p style="font-style: italic; opacity: 0.8;">"The royal treasury is empty. They say the King is pawning the Crown Jewels... or confiscating gold from wealthy merchants. Hide your coin."</p>
                </div>
                
                <div style="margin-bottom: 25px; border-bottom: 1px dashed rgba(139, 69, 19, 0.2); padding-bottom: 15px;">
                    <p style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;">üåô Celestial Alignment</p>
                    <p style="font-style: italic; opacity: 0.8;">"The Twin Moons are aligning tonight. Enchanters are desperate for Moonstone shards and will pay triple the market price. Stock up now."</p>
                </div>

                <div style="margin-bottom: 25px; border-bottom: 1px dashed rgba(139, 69, 19, 0.2); padding-bottom: 15px;">
                    <p style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;">üï∏Ô∏è The Silk Caravan</p>
                    <p style="font-style: italic; opacity: 0.8;">"A caravan from the Silk Dunes vanished in the Whispering Woods. If you can hire adventurers to recover it, the exotic fabrics would be worth a fortune."</p>
                </div>

                <div>
                    <p style="font-weight: bold; color: #5d2e0a; margin-bottom: 5px;">üëÅÔ∏è The Shadow Market</p>
                    <p style="font-style: italic; opacity: 0.8;">"They say a black market opens in the sewers at midnight. The artifacts are illegal... and powerful. Do you dare trade there?"</p>
                </div>
            </div>
        </div>
    </div>
    <div id="community-modal" class="modal">
        <div class="parchment">
            <span class="close-modal" onclick="closeModals()">&times;</span>
            <h2>The Common Room</h2>
            <div class="community-links">
                <a href="https://www.findiestudios.com/" target="_blank" class="community-item"><span class="community-icon">üè∞</span> Findie</a>
                <a href="https://discord.gg/findiestudios" target="_blank" class="community-item"><span class="community-icon">‚öîÔ∏è</span> Discord</a>
                <a href="https://x.com/FindieStudios" target="_blank" class="community-item"><span class="community-icon">üìú</span> Twitter</a>
                <a href="https://www.youtube.com/@FindieStudios" target="_blank" class="community-item"><span class="community-icon">üõ°Ô∏è</span> YouTube</a>
                <a href="https://www.instagram.com/findiestudios" target="_blank" class="community-item"><span class="community-icon">üè∫</span> Instagram</a>
                <a href="https://www.tiktok.com/@findiestudios" target="_blank" class="community-item"><span class="community-icon">üé≠</span> TikTok</a>
                <a href="https://www.reddit.com/r/arcanemerchant" target="_blank" class="community-item"><span class="community-icon">‚öíÔ∏è</span> Reddit</a>
                <a href="https://www.linkedin.com/company/findiestudios" target="_blank" class="community-item"><span class="community-icon">üóùÔ∏è</span> LinkedIn</a>
            </div>
        </div>
    </div>

    <div id="about-modal" class="modal">
        <div class="parchment" style="max-width: 850px; width: 95vw;">
            <span class="close-modal" onclick="closeModals()">&times;</span>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid rgba(139, 69, 19, 0.3); padding-bottom: 15px;">
                <h2 style="margin: 0; border: none;">The Merchant's Guide</h2>
                <select id="lang-select" onchange="updateAboutText(this.value)" style="background: rgba(139, 69, 19, 0.1); border: 1px solid #8b4513; color: #2c1e0f; padding: 5px 10px; font-family: var(--ui-font); cursor: pointer; border-radius: 4px;">
                    <!-- Options populated by JS -->
                </select>
            </div>
            
            <div id="about-content" style="margin-top: 20px; line-height: 1.6; font-size: 1.1rem;">
                <p id="about-intro" style="margin-bottom: 25px; font-style: italic;"></p>
                <div id="about-features" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                    <!-- Features populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <div id="video-modal" class="modal">
        <div class="parchment" style="max-width: 900px; background: #0a0a0a; border: 2px solid var(--gold); padding: 10px;">
            <span class="close-modal" onclick="closeVideoModal()">&times;</span>
            <div class="video-container"><video id="video-player" controls muted playsinline></video></div>
        </div>
    </div>

    <script src="translations.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const dialogueElement = document.getElementById('dialogue');
        const welcomeText = "Approach the hearth, seeker. Outside, the Void hungers, but within these walls, the ancient laws of trade provide a sanctuary for the bold.";
        
        const merchantDialogues = [
            "Information is the unseen currency of the realm. A whisper in the right ear can collapse empires or forge a king. What secrets do you seek to purchase?",
            "The ravens carry our sigil across the kingdoms. Join the assembly in the Common Room, where the whispers of the future are woven into reality.",
            "Being a merchant is more than just counting gold. It is an art of logistics, a dance of pricing, and the crafting of a sanctuary.",
            "Every coin traded is a signal. Will you strengthen the town's infrastructure, or seek to redefine the calculus of your own reward?",
            "Traders from the distant realms arrive without warning and vanish like mist. Timing is the only magic that truly matters here.",
            "In these lands, Fame is a functional currency‚Äîmore potent than gold. A high reputation opens doors that keys cannot touch.",
            "In economic downturns, your reputation is your shield. Social trust is the only armor that softens a market-wide recession.",
            "No two shops are alike. Seek differentiation, find your niche, and hunt for 'hero' artifacts that carry an outsized cachet.",
            "The market never sleeps. A savvy merchant anticipates the cycle before the first ripple appears on the surface."
        ];

        let currentDialogueIndex = 0;
        let typeTimeout;
        let isTyping = false;
        let hls;

        function handleWatch() { showVideoModal(); typeWriter("Behold the memories of the trade... visions of what was and what is yet to come.", dialogueElement, 30); }
        function handleWares() { showModal('wares-modal'); initCarousel(); typeWriter("Behold the relics of an age forgotten.", dialogueElement, 30); }
        function handleRumors() { showModal('rumors-modal'); typeWriter("The walls have ears, and the wind has a tongue.", dialogueElement, 30); }
        function handleCommunity() { showModal('community-modal'); typeWriter("The ravens carry our news...", dialogueElement, 30); }
        function handleAbout() {
            showModal('about-modal');
            typeWriter("The story of the merchant is written in many tongues...", dialogueElement, 30);
            initAbout();
        }

        function initAbout() {
            const select = document.getElementById('lang-select');
            if (select.options.length === 0) {
                // Populate languages
                Object.keys(translations).forEach(code => {
                    const option = document.createElement('option');
                    option.value = code;
                    option.text = translations[code].name;
                    select.appendChild(option);
                });
                // Default to English
                select.value = 'en';
                updateAboutText('en');
            }
        }

        function updateAboutText(langCode) {
            const data = translations[langCode];
            if (!data) return;
            
            document.getElementById('about-intro').innerText = data.intro;
            
            const featuresContainer = document.getElementById('about-features');
            featuresContainer.innerHTML = '';
            
            data.features.forEach(feature => {
                const p = document.createElement('p');
                // feature string contains "Emoji Headline \n Body"
                // We want to make Headline Bold.
                
                // Split by newline
                const parts = feature.split('\n');
                const headline = parts[0];
                const body = parts[1] || "";
                
                p.innerHTML = `<strong>${headline}</strong><br><span style="opacity: 0.9; font-size: 0.95em;">${body}</span>`;
                
                p.style.marginBottom = '20px';
                p.style.paddingLeft = '15px';
                p.style.borderLeft = '3px solid #d4af37';
                featuresContainer.appendChild(p);
            });
            
            // Handle Ending
            let endingEl = document.getElementById('about-ending');
            if (!endingEl) {
                endingEl = document.createElement('p');
                endingEl.id = 'about-ending';
                endingEl.style.marginTop = '30px';
                endingEl.style.fontWeight = 'bold';
                endingEl.style.color = '#d4af37';
                endingEl.style.textAlign = 'center';
                document.getElementById('about-content').appendChild(endingEl);
            }
            endingEl.innerText = data.ending || "";
        }

        function showModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.classList.add('visible');
        }

        function closeModals() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('visible'));
            stopC();
        }

        function showVideoModal() {
            const modal = document.getElementById('video-modal'), video = document.getElementById('video-player');
            const src = 'https://video.fastly.steamstatic.com/store_trailers/4086760/1025836541/d1d348ada576efe61787479707370305904dfecb/1769431428/hls_264_master.m3u8';
            modal.classList.add('visible');
            if (Hls.isSupported()) {
                if (hls) hls.destroy();
                hls = new Hls(); hls.loadSource(src); hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            }
        }

        function closeVideoModal() { document.getElementById('video-player').pause(); closeModals(); }

        function typeWriter(text, element, speed = 35, callback) {
            if (isTyping) clearTimeout(typeTimeout);
            isTyping = true; element.innerHTML = ""; let i = 0;
            function type() {
                if (i < text.length) { element.innerHTML += text.charAt(i); i++; typeTimeout = setTimeout(type, speed); }
                else { isTyping = false; if (callback) callback(); }
            }
            type();
        }

        let carouselImages = [];
        // Add Images
        for (let i = 1; i <= 16; i++) {
            carouselImages.push({
                type: 'image',
                src: `images/inventory/inventory_${i}.jpg?v=force_refresh_${Date.now()}`
            });
        }
        
        // Inject Videos into the feed
        carouselImages.splice(2, 0, { type: 'video', src: 'images/inventory/story_clip_1.mp4' });
        carouselImages.splice(5, 0, { type: 'video', src: 'images/inventory/story_clip_2.mp4' });
        carouselImages.splice(8, 0, { type: 'video', src: 'images/inventory/story_clip_3.mp4' });
        carouselImages.splice(11, 0, { type: 'video', src: 'images/inventory/story_clip_4.mp4' });
        carouselImages.splice(14, 0, { type: 'video', src: 'images/inventory/story_clip_5.mp4' });
        carouselImages.splice(17, 0, { type: 'video', src: 'images/inventory/story_clip_6.mp4' });
        
        let currentCarouselIndex = 0, carouselInterval, carouselInitialized = false;

        function initCarousel() {
            // Generate Progress Bars
            const progressContainer = document.getElementById('story-progress');
            progressContainer.innerHTML = '';
            
            carouselImages.forEach((_, index) => {
                const bar = document.createElement('div');
                bar.className = 'story-bar';
                const fill = document.createElement('div');
                fill.className = 'story-bar-fill';
                bar.appendChild(fill);
                progressContainer.appendChild(bar);
            });
            
            startC();
        }

        function startC() {
            stopC(); 
            showCarouselImage(currentCarouselIndex);
            // Timer logic moved to showCarouselImage to handle variable durations
        }

        function stopC() { 
            if (carouselInterval) clearTimeout(carouselInterval); // Changed from interval to timeout
            const video = document.getElementById('story-video');
            if (video) {
                video.onended = null; // Clear event listener
                video.pause();
            }
        }

        function showCarouselImage(index) {
            // Loop logic
            if (index >= carouselImages.length) {
                currentCarouselIndex = 0;
            } else if (index < 0) {
                currentCarouselIndex = carouselImages.length - 1;
            } else {
                currentCarouselIndex = index;
            }

            const item = carouselImages[currentCarouselIndex];
            
            // DOM Elements
            const mainImg = document.getElementById('story-image');
            const mainVideo = document.getElementById('story-video');
            const bgDiv = document.getElementById('story-bg');
            
            // ANIMATE PROGRESS BAR
            // Reset all bars
            const bars = document.querySelectorAll('.story-bar-fill');
            bars.forEach(b => { b.style.width = '0%'; b.style.transition = 'none'; });
            
            // Fill past bars
            for(let i=0; i<currentCarouselIndex; i++) {
                bars[i].style.width = '100%';
            }

            // Setup Current Bar Animation
            const currentBar = bars[currentCarouselIndex];
            
            if (item.type === 'video') {
                // Show Video
                mainImg.style.display = 'none';
                mainVideo.style.display = 'block';
                mainVideo.src = item.src;
                mainVideo.currentTime = 0;
                
                // Transparent BG
                bgDiv.style.backgroundImage = 'none';
                bgDiv.style.backgroundColor = 'transparent';

                // Play & Handle Duration
                mainVideo.play().then(() => {
                    // Animate Bar based on duration
                    const duration = mainVideo.duration || 10; // Fallback
                    currentBar.style.transition = `width ${duration}s linear`;
                    // Trigger reflow
                    void currentBar.offsetWidth; 
                    currentBar.style.width = '100%';
                    
                    mainVideo.onended = () => moveCarousel(1);
                }).catch(e => {
                    console.log("Autoplay blocked", e);
                    // Fallback timer if play fails
                    carouselInterval = setTimeout(() => moveCarousel(1), 4000);
                });

            } else {
                // Show Image
                if (mainVideo) {
                    mainVideo.pause();
                    mainVideo.style.display = 'none';
                }
                mainImg.style.display = 'block';
                mainImg.src = item.src;
                if (bgDiv) bgDiv.style.backgroundImage = `url('${item.src}')`;
                
                // Animate Bar (Fixed 4s)
                currentBar.style.transition = 'width 4s linear';
                void currentBar.offsetWidth;
                currentBar.style.width = '100%';
                
                carouselInterval = setTimeout(() => moveCarousel(1), 4000);
            }
        }

        function moveCarousel(step) { 
            stopC(); // Stop current timer/video
            // Update index immediately for next call
            // showCarouselImage handles index wrapping, but we need to pass the target index
            // Actually, showCarouselImage updates currentCarouselIndex internally? 
            // Yes, let's fix that structure.
            
            // Simpler: Just call show with target index
            let target = currentCarouselIndex + step;
            showCarouselImage(target);
        }

        window.onload = () => {
            const ui = document.getElementById('game-ui');
            if (ui) ui.classList.add('ready');
            
            // Spawn Embers
            setInterval(() => {
                const ember = document.createElement('div');
                ember.className = 'ember';
                ember.style.left = Math.random() * 100 + 'vw';
                ember.style.animationDuration = (Math.random() * 5 + 5) + 's';
                ember.style.opacity = Math.random();
                document.body.appendChild(ember);
                
                setTimeout(() => ember.remove(), 10000);
            }, 300); // New ember every 300ms

            setTimeout(() => {
                typeWriter(welcomeText, dialogueElement, 40);
                setInterval(() => {
                    if (!isTyping) {
                        currentDialogueIndex = (currentDialogueIndex + 1) % merchantDialogues.length;
                        typeWriter(merchantDialogues[currentDialogueIndex], dialogueElement, 35);
                    }
                }, 12000);
            }, 800);
        };

        const closeAll = e => { if (e.target.classList.contains('modal')) closeVideoModal(); };
        window.onclick = closeAll;
        window.ontouchstart = closeAll;
    </script>
</body>
</html>
